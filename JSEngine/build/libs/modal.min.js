"use strict";jse.libs.modal=jse.libs.modal||{},function(t){var e={yes:{name:jse.core.lang.translate("yes","buttons"),type:"success"},no:{name:jse.core.lang.translate("no","buttons"),type:"fail"},abort:{name:jse.core.lang.translate("abort","buttons"),type:"fail"},ok:{name:jse.core.lang.translate("ok","buttons"),type:"success"},close:{name:jse.core.lang.translate("close","buttons"),type:"fail"}},a=function(t,e){var a=t.filter("form").add(t.find("form")),n={},l=[];return a.length&&a.each((function(){var t=$(this);if(e){var a=$.Deferred();l.push(a),t.trigger("validator.validate",{deferred:a})}var o=t.attr("name")||t.attr("id")||"form_"+(new Date).getTime()*Math.random();n[o]=window.jse.lib.form.getData(t)})),$.when.apply(void 0,l).then((function(){return n}),(function(){return n})).promise()},n=function(t,e){a(t).always((function(a){e.reject(a),t.dialog("close").remove()}))},l=function(t,e){a(t,!0).done((function(a){e.resolve(a),t.dialog("close").remove()}))},o=function(t,a,o,r,s){var i=$.Deferred(),d=i.promise(),c="",u={title:a||"",dialogClass:o||"",modal:!0,resizable:!1,buttons:r||[e.close],draggable:!1,closeOnEscape:!1,autoOpen:!1,template:s||"#modal_alert",storeTemplate:!1,closeX:!0,modalClose:!1},m=null,f=null;return t=t||{},(t=$.extend({},u,t)).buttons=function(t,e){var a=[],o=null;return t&&$.each(t,(function(t,r){(o={}).text=r.name||"BUTTON",o.click=function(){var t=$(this);switch("function"==typeof r.callback&&r.callback.apply(t,[]),r.type){case"fail":n(t,e);break;case"success":l(t,e)}},a.push(o)})),a}(t.buttons,i),function(t){var e=[],a=$.Deferred();try{e=$(t.template)}catch(e){jse.core.debug(jse.core.lang.templateNotFound(t.template))}return e.length?a.resolve(e.html()):window.jse.lib.ajax({url:t.template,dataType:"html"}).done((function(e){if(t.storeTemplate){var n=$("<div />").attr("id",t.template).html(e);$("body").append(n)}a.resolve(e)})).fail((function(){a.reject()})),a}(t).done((function(e){c=$(Mustache.render(e,t)),t.validator&&c.find("form").attr("data-gx-widget","validator").find("input").attr({"data-validator-validate":t.validator.validate,"data-validator-regex":t.validator.regex||""}).addClass("validate"),c.dialog(t);try{m=c.dialog("instance")}catch(t){m=c.data("ui-dialog")}m.uiButtonSet.children().addClass("btn btn-default"),!1===t.closeX?m.uiDialogTitlebarClose.remove():m.uiDialogTitlebarClose.html("&times;").one("click",(function(){n(m.element,i)})),t.modalClose&&$("body").find(".ui-widget-overlay").last().one("click",(function(){n(m.element,i)})),(f=m.element.find("form")).length&&f.on("submit",(function(t){t.preventDefault()})),t.executeCode&&"function"==typeof t.executeCode&&t.executeCode.call($(m.element)),d.close=function(t){t?n(m.element,i):l(m.element,i)},c.dialog("open"),window.gx&&window.jse.widgets&&window.jse.widgets.init&&(window.jse.widgets.init(c),window.jse.controllers.init(c),window.jse.extensions.init(c))})).fail((function(){i.reject({error:"Template not found"})})),d};function r(t){jse.core.debug.warn("Used deprecated modal method "+t+" which will be removed in JSE v1.5.")}t.alert=function(t){r("jse.libs.modal.alert()");var a=$.extend({},{draggable:!0},t);return o(a,jse.core.lang.translate("hint","labels"),"",[e.ok])},t.confirm=function(t){r("jse.libs.modal.confirm()");var a=$.extend({},{draggable:!0},t);return o(a,jse.core.lang.translate("confirm","labels"),"confirm_dialog",[e.no,e.yes])},t.prompt=function(t){r("jse.libs.modal.prompt()");var a=$.extend({},{draggable:!0},t);return o(a,jse.core.lang.translate("prompt","labels"),"prompt_dialog",[e.abort,e.ok],"#modal_prompt")},t.success=function(t){r("jse.libs.modal.success()");var e=$.extend({},{draggable:!0},t);return o(e,jse.core.lang.translate("success","labels"),"success_dialog")},t.error=function(t){r("jse.libs.modal.error()");var e=$.extend({},{draggable:!0},t);return o(e,jse.core.lang.translate("error","labels"),"error_dialog")},t.warn=function(t){r("jse.libs.modal.warn()");var e=$.extend({},{draggable:!0},t);return o(e,jse.core.lang.translate("warning","labels"),"warn_dialog")},t.info=function(t){r("jse.libs.modal.info()");var e=$.extend({},{draggable:!0},t);return o(e,jse.core.lang.translate("info","labels"),"info_dialog")},t.message=function(t){$("body").append('<div class="modal-layer">'+t.content+"</div>"),t.modal=!0,t.dialogClass="gx-container",void 0===t.buttons&&(t.buttons=[{text:e.close.name,click:function(){$(this).dialog("close"),$(this).remove()}}]),$(".modal-layer:last").dialog(t)},t.showMessage=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a||(a=[{title:jse.core.lang.translate("CLOSE","general"),class:"btn btn-default",callback:function(t){return $(t.currentTarget).parents(".modal").modal("hide")}}]);var n='<div class="modal fade" tabindex="-1" role="dialog">\n\t\t\t\t\t\t<div class="modal-dialog">\n\t\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t\t<button type="button" class="close" data-dismiss="modal" aria-label="Close">\n\t\t\t\t\t\t\t\t\t\t<span aria-hidden="true">&times;</span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<h4 class="modal-title">'+t+'</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t                '+e+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="modal-footer"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>',l=$(n).appendTo("body");return a.forEach((function(t){var e=$("<button/>");e.text(t.title).attr("class",t.class||"btn btn-default"),t.callback&&e.on("click",t.callback),e.appendTo(l.find(".modal-footer"))})),l.on("hidden.bs.modal",(function(){return l.remove()})),l.modal("show"),l}}(jse.libs.modal);