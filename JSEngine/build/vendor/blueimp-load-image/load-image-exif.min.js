!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}((function(e){"use strict";e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(i,t,n){if(n&&!(t+n>i.byteLength))return e.createObjectURL(new Blob([i.buffer.slice(t,t+n)]));console.log("Invalid Exif data: Invalid thumbnail data.")},e.exifTagTypes={1:{getValue:function(e,i){return e.getUint8(i)},size:1},2:{getValue:function(e,i){return String.fromCharCode(e.getUint8(i))},size:1,ascii:!0},3:{getValue:function(e,i,t){return e.getUint16(i,t)},size:2},4:{getValue:function(e,i,t){return e.getUint32(i,t)},size:4},5:{getValue:function(e,i,t){return e.getUint32(i,t)/e.getUint32(i+4,t)},size:8},9:{getValue:function(e,i,t){return e.getInt32(i,t)},size:4},10:{getValue:function(e,i,t){return e.getInt32(i,t)/e.getInt32(i+4,t)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(i,t,n,a,f,s){var r,l,o,g,u,x,d=e.exifTagTypes[a];if(d){if(!((l=(r=d.size*f)>4?t+i.getUint32(n+8,s):n+8)+r>i.byteLength)){if(1===f)return d.getValue(i,l,s);for(o=[],g=0;g<f;g+=1)o[g]=d.getValue(i,l+g*d.size,s);if(d.ascii){for(u="",g=0;g<o.length&&"\0"!==(x=o[g]);g+=1)u+=x;return u}return o}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},e.parseExifTag=function(i,t,n,a){return{number:i.getUint16(n,a),value:e.getExifValue(i,t,n,i.getUint16(n+2,a),i.getUint32(n+4,a),a)}},e.parseExifTags=function(e,i,t,n,a){var f,s,r,l,o;if(t+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((s=t+2+12*(f=e.getUint16(t,n)))+4>e.byteLength)){for(r=0;r<f;r+=1)l=t+2+12*r,o=this.parseExifTag(e,i,l,n,a),a.exif[o.number]=o.value,a.exifOffsets&&(a.exifOffsets[o.number]=l);return e.getUint32(s,n)}console.log("Invalid Exif data: Invalid directory size.")}},e.parseExifData=function(i,t,n,a,f){if(!f.disableExif){var s,r,l,o=t+10;if(1165519206===i.getUint32(t+4))if(o+8>i.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===i.getUint16(t+8)){switch(i.getUint16(o)){case 18761:s=!0;break;case 19789:s=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===i.getUint16(o+2,s)?(r=i.getUint32(o+4,s),a.exif=new e.ExifMap,f.disableExifOffsets||(a.exifOffsets=new e.ExifMap,a.exifTiffOffset=o,a.exifLittleEndian=s),(r=e.parseExifTags(i,o,o+r,s,a))&&!f.disableExifThumbnail&&(l={exif:{}},r=e.parseExifTags(i,o,o+r,s,l),l.exif[513]&&(a.exif.Thumbnail=e.getExifThumbnail(i,o+l.exif[513],l.exif[514]))),a.exif[34665]&&!f.disableExifSub&&e.parseExifTags(i,o,o+a.exif[34665],s,a),a.exif[34853]&&!f.disableExifGps&&e.parseExifTags(i,o,o+a.exif[34853],s,a)):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},e.metaDataParsers.jpeg[65505].push(e.parseExifData),e.exifWriters={274:function(e,i,t){return new DataView(e,i.exifOffsets[274]+8,2).setUint16(0,t,i.exifLittleEndian),e}},e.writeExifData=function(i,t,n,a){e.exifWriters[t.exif.map[n]](i,t,a)}}));