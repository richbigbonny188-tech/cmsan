!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}((function(e){"use strict";var a="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=a&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},e.metaDataParsers={jpeg:{65505:[],65517:[]}},e.parseMetaData=function(a,t,i,r){r=r||{};var o=this,n=(i=i||{}).maxMetaDataSize||262144;!!("undefined"!=typeof DataView&&a&&a.size>=12&&"image/jpeg"===a.type&&e.blobSlice)&&e.readFile(e.blobSlice.call(a,0,n),(function(a){if(a.target.error)return console.log(a.target.error),void t(r);var n,l,s,c,f=a.target.result,d=new DataView(f),g=2,p=d.byteLength-4,b=g;if(65496===d.getUint16(0)){for(;g<p&&((n=d.getUint16(g))>=65504&&n<=65519||65534===n);){if(g+(l=d.getUint16(g+2)+2)>d.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if((s=e.metaDataParsers.jpeg[n])&&!i.disableMetaDataParsers)for(c=0;c<s.length;c+=1)s[c].call(o,d,g,l,r,i);b=g+=l}!i.disableImageHead&&b>6&&(f.slice?r.imageHead=f.slice(0,b):r.imageHead=new Uint8Array(f).subarray(0,b))}else console.log("Invalid JPEG file: Missing JPEG marker.");t(r)}),"readAsArrayBuffer")||t(r)},e.replaceHead=function(a,t,i){e.parseMetaData(a,(function(r){i(new Blob([t,e.blobSlice.call(a,r.imageHead.byteLength)],{type:"image/jpeg"}))}),{maxMetaDataSize:256,disableMetaDataParsers:!0})},e.hasMetaOption=function(e){return e&&e.meta};var t=e.transform;e.transform=function(a,i,r,o,n){e.hasMetaOption(i)?e.parseMetaData(o,(function(n){t.call(e,a,i,r,o,n)}),i,n):t.apply(e,arguments)}}));