/*!
 * jQuery UI date range picker widget
 * Copyright (c) 2017 Tamble, Inc.
 * Licensed under MIT (https://github.com/tamble/jquery-ui-daterangepicker/raw/master/LICENSE.txt)
 *
 * Depends:
 *   - jQuery 1.8.3+
 *   - jQuery UI 1.9.0+ (widget factory, position utility, button, menu, datepicker)
 *   - moment.js 2.3.0+
 */
!function(t,e,n){var a=0;function o(e,n,a){var o,r,i;return o=t("<div></div>").addClass(e+"-presets"),r=t("<ul></ul>"),i=void 0===t.ui.menu.prototype.options.items?{start:'<li><a href="#">',end:"</a></li>"}:{start:"<li><div>",end:"</div></li>"},t.each(n.presetRanges,(function(){t(i.start+this.text+i.end).data("dateStart",this.dateStart).data("dateEnd",this.dateEnd).click(a).appendTo(r)})),o.append(r),r.menu().data("ui-menu").delay=0,{getElement:function(){return o}}}t.widget("comiseo.daterangepicker",{version:"0.6.0-beta.1",options:{presetRanges:[{text:"Today",dateStart:function(){return moment()},dateEnd:function(){return moment()}},{text:"Yesterday",dateStart:function(){return moment().subtract("days",1)},dateEnd:function(){return moment().subtract("days",1)}},{text:"Last 7 Days",dateStart:function(){return moment().subtract("days",6)},dateEnd:function(){return moment()}},{text:"Last Week (Mo-Su)",dateStart:function(){return moment().subtract("days",7).isoWeekday(1)},dateEnd:function(){return moment().subtract("days",7).isoWeekday(7)}},{text:"Month to Date",dateStart:function(){return moment().startOf("month")},dateEnd:function(){return moment()}},{text:"Previous Month",dateStart:function(){return moment().subtract("month",1).startOf("month")},dateEnd:function(){return moment().subtract("month",1).endOf("month")}},{text:"Year to Date",dateStart:function(){return moment().startOf("year")},dateEnd:function(){return moment()}}],initialText:"Select date range...",icon:"ui-icon-triangle-1-s",applyButtonText:"Apply",clearButtonText:"Clear",cancelButtonText:"Cancel",rangeSplitter:" - ",dateFormat:"M d, yy",altFormat:"yy-mm-dd",verticalOffset:0,mirrorOnCollision:!0,autoFitCalendars:!0,applyOnMenuSelect:!0,open:null,close:null,change:null,clear:null,cancel:null,onOpen:null,onClose:null,onChange:null,onClear:null,datepickerOptions:{numberOfMonths:3,maxDate:0}},_create:function(){this._dateRangePicker=function(n,r,i){var c,u,s,l,d,f,p="comiseo-daterangepicker",g=!1,m=!1,h=["left","right","top","bottom"],b=1,y=null;function v(){if(i.autoFitCalendars){var n=t(e).width(),a=c.outerWidth(!0),o=d.getElement(),r=o.datepicker("option","numberOfMonths"),u=r;if(a>n){for(;r>1&&c.outerWidth(!0)>n;)o.datepicker("option","numberOfMonths",--r);r!==u&&(v.monthWidth=(a-c.outerWidth(!0))/(u-r))}else for(;r<v.numberOfMonths&&n-c.outerWidth(!0)>=v.monthWidth;)o.datepicker("option","numberOfMonths",++r);R(),m=!1}}function O(e){var n=i.dateFormat;return t.datepicker.formatDate(n,e.start)+(+e.end!=+e.start?i.rangeSplitter+t.datepicker.formatDate(n,e.end):"")}function k(){var t=x();t?(s.setLabel(O(t)),d.setRange(t)):d.reset()}function C(e,a){var o=e||d.getRange();o.start&&(o.end||(o.end=o.start),e&&d.setRange(o),s.setLabel(O(o)),n.val(function(e){var n=i.altFormat,a={};return a.start=t.datepicker.formatDate(n,e.start),a.end=t.datepicker.formatDate(n,e.end),JSON.stringify(a)}(o)).change(),i.onChange&&i.onChange(),r._trigger("change",a,{instance:r}))}function x(){return function(e){var n=i.altFormat,a=null;if(e)try{a=JSON.parse(e,(function(e,a){return e?t.datepicker.parseDate(n,a):a}))}catch(t){}return a}(n.val())}function E(t){s.reset(),d.reset(),i.onClear&&i.onClear(),r._trigger("clear",t,{instance:r})}function S(e){var n=t(this),a=n.data("dateStart")().startOf("day").toDate(),o=n.data("dateEnd")().startOf("day").toDate();return d.setRange({start:a,end:o}),i.applyOnMenuSelect&&(_(e),C(null,e)),!1}function R(){c.position({my:"left top",at:"left bottom"+(i.verticalOffset<0?i.verticalOffset:"+"+i.verticalOffset),of:s.getElement(),collision:"flipfit flipfit",using:function(t,e){var n,a,o=e.element.left+e.element.width/2,r=e.target.left+e.target.width/2,u=b,f=e.element.top+e.element.height/2,g=e.target.top+e.target.height/2,m=y;(b=o>r?1:0)!==u&&(i.mirrorOnCollision&&(n=0===b?l:d,c.children().first().append(n.getElement())),c.removeClass(p+"-"+h[u]),c.addClass(p+"-"+h[b])),c.css({left:t.left,top:t.top}),(y=f>g?3:2)!==m&&(null!==m&&s.getElement().removeClass(p+"-"+h[m]),s.getElement().addClass(p+"-"+h[y])),a=3===y&&e.element.top-e.target.top!==e.target.height+i.verticalOffset||2===y&&e.target.top-e.element.top!==e.element.height+i.verticalOffset,s.getElement().toggleClass(p+"-vfit",a)}})}function w(t){t.preventDefault(),t.stopPropagation()}function T(e){switch(e.which){case t.ui.keyCode.UP:case t.ui.keyCode.DOWN:return w(e),void D(e);case t.ui.keyCode.ESCAPE:return w(e),_(e),void k();case t.ui.keyCode.TAB:return void _(e)}}function D(t){g||(s.getElement().addClass(p+"-active"),u.show(),g=!0,m&&v(),d.scrollToRangeStart(),c.show(),R()),i.onOpen&&i.onOpen(),r._trigger("open",t,{instance:r})}function _(t){g&&(c.hide(),u.hide(),s.getElement().removeClass(p+"-active"),g=!1),i.onClose&&i.onClose(),r._trigger("close",t,{instance:r})}function P(t){g?(_(t),k()):D(t)}return function(){s=function(e,n,o){var r,i;function c(t){r.button("option","label",t)}return function(){i="drp_autogen"+a++,t('label[for="'+e.attr("id")+'"]').attr("for",i),r=t('<button type="button"></button>').addClass(n+"-triggerbutton").attr({title:e.attr("title"),tabindex:e.attr("tabindex"),id:i}).button({icons:{secondary:o.icon},icon:o.icon,iconPosition:"end",label:o.initialText})}(),{getElement:function(){return r},getLabel:function(){return r.button("option","label")},setLabel:c,reset:function(){e.val("").change(),c(o.initialText)},enforceOptions:function(){r.button("option",{icons:{secondary:o.icon},icon:o.icon,iconPosition:"end",label:o.initialText})}}}(n,p,i),l=o(p,i,S),d=function(e,n){var a,o={start:null,end:null};function r(e,a){var r=n.datepickerOptions.dateFormat||t.datepicker._defaults.dateFormat,i=t.datepicker.parseDate(r,e);!o.start||o.end?(o.start=i,o.end=null):i<o.start?(o.end=o.start,o.start=i):o.end=i,n.datepickerOptions.hasOwnProperty("onSelect")&&n.datepickerOptions.onSelect(e,a)}function i(t){var e=[!0,o.start&&(+t==+o.start||o.end&&o.start<=t&&t<=o.end)?"ui-state-highlight":""],a=[!0,"",""];return n.datepickerOptions.hasOwnProperty("beforeShowDay")&&(a=n.datepickerOptions.beforeShowDay(t)),[e[0]&&a[0],e[1]+" "+a[1],a[2]]}function c(){a.datepicker("refresh"),a.datepicker("setDate",null)}return function(){(a=t("<div></div>",{class:e+"-calendar ui-widget-content"})).datepicker(t.extend({},n.datepickerOptions,{beforeShowDay:i,onSelect:r})),function t(){setTimeout((function(){c(),t()}),moment().endOf("day")-moment())}()}(),{getElement:function(){return a},scrollToRangeStart:function(){o.start&&a.datepicker("setDate",o.start)},getRange:function(){return o},setRange:function(t){o=t,c()},refresh:c,reset:function(){o={start:null,end:null},c()},enforceOptions:function(){a.datepicker("option",t.extend({},n.datepickerOptions,{beforeShowDay:i,onSelect:r}))}}}(p,i),v.numberOfMonths=i.datepickerOptions.numberOfMonths,v.numberOfMonths instanceof Array&&(i.autoFitCalendars=!1);f=function(e,n,a){var o,r,i,c;return function(){o=t("<div></div>").addClass(e+"-buttonpanel"),n.applyButtonText&&(r=t('<button type="button" class="ui-priority-primary"></button>').text(n.applyButtonText).button(),o.append(r));n.clearButtonText&&(i=t('<button type="button" class="ui-priority-secondary"></button>').text(n.clearButtonText).button(),o.append(i));n.cancelButtonText&&(c=t('<button type="button" class="ui-priority-secondary"></button>').text(n.cancelButtonText).button(),o.append(c));a&&(r&&r.click(a.onApply),i&&i.click(a.onClear),c&&c.click(a.onCancel))}(),{getElement:function(){return o},enforceOptions:function(){r&&r.button("option","label",n.applyButtonText);i&&i.button("option","label",n.clearButtonText);c&&c.button("option","label",n.cancelButtonText)}}}(p,i,{onApply:function(t){_(t),C(null,t)},onClear:function(t){_(t),E(t)},onCancel:function(t){r._trigger("cancel",t,{instance:r}),_(t),k()}}),c=t("<div></div>",{class:p+" "+p+"-"+h[b]+" ui-widget ui-widget-content ui-corner-all ui-front"}).append(t("<div></div>",{class:p+"-main ui-widget-content"}).append(l.getElement()).append(d.getElement())).append(t('<div class="ui-helper-clearfix"></div>').append(f.getElement())).hide(),n.hide().after(s.getElement()),u=t("<div></div>",{class:"ui-front "+p+"-mask"}).hide(),t("body").append(u).append(c),v(),k(),s.getElement().click(P),s.getElement().keydown(T),u.click((function(t){_(t),k()})),t(e).resize((function(){g?v():m=!0}))}(),{toggle:P,destroy:function(){c.remove(),s.getElement().remove(),n.show()},open:D,close:_,setRange:C,getRange:x,clearRange:E,reset:k,enforceOptions:function(){var t=l;l=o(p,i,S),t.getElement().replaceWith(l.getElement()),d.enforceOptions(),f.enforceOptions(),s.enforceOptions();var e=x();e&&s.setLabel(O(e))},getContainer:function(){return c}}}(this.element,this,this.options)},_destroy:function(){this._dateRangePicker.destroy()},_setOptions:function(t){this._super(t),this._dateRangePicker.enforceOptions()},open:function(){this._dateRangePicker.open()},close:function(){this._dateRangePicker.close()},setRange:function(t){this._dateRangePicker.setRange(t)},getRange:function(){return this._dateRangePicker.getRange()},clearRange:function(){this._dateRangePicker.clearRange()},widget:function(){return this._dateRangePicker.getContainer()}})}(jQuery,window);