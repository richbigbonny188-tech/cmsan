/* GMMegaFlyOver.js <?php
#   --------------------------------------------------------------
#   GMMegaFlyOver.js 2018-06-15
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2018 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6 1y(e){m f=4,E=0,p=0,1q=e,Q=1I 1G(),l=\'\',H=0,1j=M,u=0;4.1h=6(){$(\'#3\').X();$(\'.1e\').1d(\'<F O="3"></F>\');$(\'#3\').8({1r:"M",15:"14",13:"1V"});$(\'#3\').1P(\'19.10?1g=1k&1l=0\');$(\'.7\').x(6(a){2(g)9.h(\'7 x (1Z 1x)\');$(\'#3\').8({L:a.s+5,K:a.r+5,13:"1z"})});$(\'.7\').Y(6(a){$(\'#3\').8({L:a.s+5,K:a.r+5})})};4.1p=6(){$(\'.7\').1n(\'Y\');$(\'.7\').1m(\'Y\',6(a){Q=a;f.T(a)});$(\'.7\').1n(\'x\');$(\'.7\').1m(\'x\',6(b){2(g)9.h(\'7 x\');m c=4;2(B($(4).A(\'z\').v(\'1f\'))!=\'N\'){$(4).A(\'z\').v(\'1f\',\'\')}2(B($(4).A(\'z\').v(\'11\'))!=\'N\'){$(4).A(\'z\').v(\'11\',\'\')}$(\'#3\').X();$(\'.1e\').1d(\'<F O="3" 1A="1B-1F"></F>\');$(\'#3\').8({1r:"M",15:"14",L:b.s+5,K:b.r+5});$(\'#3\').Z();m d=$(4).v(\'O\');d=d.21(\'1s\');d=d.1u();2(g)9.h(\'1w: \'+d);l=d;$(4).12(\'k\');$(4).k(6(a){2(g)9.h(\'7 k: \'+d);l=\'\';J(H);I(p)});J(H);H=16(6(){f.17(l)},M)})};4.17=6(c){2(c!=\'\'&&c==l){1H.18({1Q:\'\',1U:\'19.10?1g=1k&1l=\'+n(c),1W:"1X",1Y:G,1a:6(b){2(c==l){$(\'#3\').1b(b);2(1q==G){I(p);p=1t(f.1c,1v)}t{$(\'#q .j\').W(0).w()}$(\'#3\').w();f.T(Q);$(\'.7\').12(\'k\');$(\'.7\').k(6(a){2(g)9.h(\'7 k: \'+c);2(B 1i==\'N\'){J(E);I(p);$(\'#3\').Z();$(\'#3\').X()}})}t{2(g)9.h(\'k 1C 18-1D 1a\')}}}).1b}};4.1c=6(){m a=G;u++;1E(i=0;i<o.V.D;++i){2(o.V[i].1J!=G){a=1K}}2(a||u>1j||1L.1M.1N(/1O/)!=-1){I(p);u=0;f.U(0)}t{2(g)9.h(\'1R V... 1S: \'+u)}1T a};4.T=6(a){2($(\'#3\').D>0){m b=a.s+5,S=a.r+5;2($(o).R()<(a.s-$(o).1o()+n($(\'#3\').8(\'R\').C(\'y\',\'\'))+20)){b=(a.s-$(o).1o()-(n($(\'#3\').8(\'R\').C(\'y\',\'\'))+20))}2((n($(\'#3\').8(\'P\').C(\'y\',\'\'))+20)+a.r>$(22).P()+$(o).23()){S=a.r-(n($(\'#3\').8(\'P\').C(\'y\',\'\'))+20)}$(\'#3\').8({L:b,K:S})}};4.U=6(a){2($(\'#q .j\').D>1){m b=n(a);2(b>=$(\'#q .j\').D){b=0}$(\'#q .j\').Z();2(g)9.h(\'w j \'+b);$(\'#q .j\').W(b).w();b++;J(E);E=16(6(){f.U(b)},24)}t{$(\'#q .j\').W(0).w()}};2(B(1i)==\'N\'){4.1p()}t{4.1h()}}',62,129,'||if|flyover_layer|this||function|flyover_item|css|console|||||||fb|log||flyover_image|mouseout|t_mouse_over_element_id|var|Number|document|t_interval|flyover|pageY|pageX|else|t_image_check_loops|attr|show|mouseover|px|img|find|typeof|replace|length|t_timeout|div|true|t_request_timeout|clearInterval|clearTimeout|top|left|100|undefined|id|height|coo_event|width|t_page_y|position_flyover|start_slideshow|images|eq|remove|mousemove|hide|php|title|unbind|display|absolute|position|setTimeout|start_request|ajax|request_port|success|html|image_check|append|wrap_shop|alt|module|bind_styleedit_mode|gm_style_edit_mode_running|t_max_image_check_loops|MegaFlyover|mf_products_id|live|off|scrollLeft|bind_flyover|t_slideshow|zIndex|_|setInterval|pop|50|products_id|mode|GMMegaFlyOver|block|class|png|before|request|for|fix|Object|jQuery|new|complete|false|navigator|userAgent|search|Opera|load|data|loading|loop|return|url|none|type|POST|async|SE||split|window|scrollTop|1000'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function GMMegaFlyOver(p_slideshow)
{
	var coo_this = this;
	var t_timeout = 0;
	var t_interval = 0;
	var t_slideshow = p_slideshow;
	var coo_event = new Object();
	var t_mouse_over_element_id = '';
	var t_request_timeout = 0;
	var t_max_image_check_loops = 100;
	var t_image_check_loops = 0;

	this.bind_styleedit_mode = function()
	{
		$('#flyover_layer').remove();
		$('.wrap_shop').append('<div id="flyover_layer"></div>');

		$('#flyover_layer').css({
			zIndex: 		"100",
			position: 	"absolute",
			display:	"none"
		});
		$('#flyover_layer').load('request_port.php?module=MegaFlyover&mf_products_id=0');


		$('.flyover_item').mouseover(function(event)
		{
			if(fb)console.log('flyover_item mouseover (SE mode)');

			$('#flyover_layer').css({
				left: 			event.pageX + 5,
				top: 				event.pageY + 5,
				display:	"block"
			});
		});

		$('.flyover_item').mousemove(function(event)
		{
			$('#flyover_layer').css({
				left: 			event.pageX + 5,
				top: 				event.pageY + 5
			});
		});
	}

	this.bind_flyover = function()
	{
		$('.flyover_item').off('mousemove');
		$('.flyover_item').on('mousemove', function(event)
		{
			coo_event = event;
			coo_this.position_flyover(event);
		});

		$('.flyover_item').off('mouseover');
		$('.flyover_item').on('mouseover', function(event)
		{
			if(fb)console.log('flyover_item mouseover');

			var t_this_element = this;

			if(typeof($(this).find('img').attr('alt')) != 'undefined')
			{
				$(this).find('img').attr('alt', '');
			}
			if(typeof($(this).find('img').attr('title')) != 'undefined')
			{
				$(this).find('img').attr('title', '');
			}

			$('#flyover_layer').remove();
			$('.wrap_shop').append('<div id="flyover_layer" class="png-fix"></div>');

			$('#flyover_layer').css({
				zIndex: 		"100",
				position: 	"absolute",
				left: 			event.pageX + 5,
				top: 				event.pageY + 5
			});

			$('#flyover_layer').hide();

			var products_id = $(this).attr('id');
			products_id = products_id.split('_');
			products_id = products_id.pop();
			if(fb)console.log('products_id: ' + products_id);

			t_mouse_over_element_id = products_id;
			$(this).unbind('mouseout');
			$(this).mouseout(function(event)
			{
				if(fb)console.log('flyover_item mouseout: ' + products_id);
				t_mouse_over_element_id = '';
				clearTimeout(t_request_timeout);
				clearInterval(t_interval);
			});

			clearTimeout(t_request_timeout);
			t_request_timeout = setTimeout(function(){coo_this.start_request(t_mouse_over_element_id);}, 100);
		});
	}

	this.start_request = function(p_mouse_over_element_id)
	{
		if(p_mouse_over_element_id != '' && p_mouse_over_element_id == t_mouse_over_element_id)
		{
			jQuery.ajax({data:		'',
						url: 		'request_port.php?module=MegaFlyover&mf_products_id=' + Number(p_mouse_over_element_id),
						type: 		"POST",
						async:		true,
						success:	function(t_flyover_html)
							{
								if(p_mouse_over_element_id == t_mouse_over_element_id)
								{
									$('#flyover_layer').html(t_flyover_html);

									if(t_slideshow == true)
									{
										clearInterval(t_interval);
										t_interval = setInterval(coo_this.image_check, 50);
									}
									else
									{
										$('#flyover .flyover_image').eq(0).show();
									}

									$('#flyover_layer').show();
									coo_this.position_flyover(coo_event);

									$('.flyover_item').unbind('mouseout');
									$('.flyover_item').mouseout(function(event)
									{
										if(fb)console.log('flyover_item mouseout: ' + p_mouse_over_element_id);

										if(typeof gm_style_edit_mode_running == 'undefined')
										{
											clearTimeout(t_timeout);
											clearInterval(t_interval);
											// IE6-workaround: hide before removing to avoid shadow deposit on screen
											$('#flyover_layer').hide();
											$('#flyover_layer').remove();
										}
									});
								}
								else
								{
									if(fb)console.log('mouseout before ajax-request success');
								}
							}
						}).html;
		}
	}

	this.image_check = function()
	{
		var t_image_loaded = true;
		t_image_check_loops++;

		for(i = 0; i < document.images.length; ++i)
		{
			if(document.images[i].complete != true)
			{
				t_image_loaded = false;
			}
		}


		if(t_image_loaded || t_image_check_loops > t_max_image_check_loops
			|| navigator.userAgent.search(/Opera/) != -1) // Opera has problems to check image complete status -> ignore check
		{
			clearInterval(t_interval);
			t_image_check_loops = 0;
			coo_this.start_slideshow(0);
		}
		else
		{
			if(fb)console.log('loading images... loop: ' + t_image_check_loops);

		}

		return t_image_loaded;
	}

	this.position_flyover = function(event)
	{
		if($('#flyover_layer').length > 0)
		{
			var t_page_x = event.pageX + 5;
			var t_page_y = event.pageY + 5;

			if($(document).width() < (event.pageX - $(document).scrollLeft() + Number($('#flyover_layer').css('width').replace('px', '')) + 20))
			{
				t_page_x = (event.pageX - $(document).scrollLeft() - (Number($('#flyover_layer').css('width').replace('px', '')) + 20));
			}

			if((Number($('#flyover_layer').css('height').replace('px', '')) + 20) + event.pageY >  $(window).height() + $(document).scrollTop())
			{
				t_page_y = event.pageY - (Number($('#flyover_layer').css('height').replace('px', '')) + 20);
			}

			$('#flyover_layer').css(
			{
				left: t_page_x,
				top: t_page_y
			});
		}
	}

	this.start_slideshow = function(p_image_number)
	{
		if($('#flyover .flyover_image').length > 1)
		{
			var t_image_number = Number(p_image_number);

			if(t_image_number >= $('#flyover .flyover_image').length)
			{
				t_image_number = 0;
			}

			$('#flyover .flyover_image').hide();

			if(fb)console.log('show flyover_image ' + t_image_number);
			$('#flyover .flyover_image').eq(t_image_number).show();

			t_image_number++;

			clearTimeout(t_timeout);
			t_timeout = setTimeout(function(){coo_this.start_slideshow(t_image_number);}, 1000);
		}
		else
		{
			$('#flyover .flyover_image').eq(0).show();
		}
	}

	if(typeof(gm_style_edit_mode_running) == 'undefined')
	{
		this.bind_flyover();
	}
	else
	{
		this.bind_styleedit_mode();
	}
}
/*<?php
}
?>*/
