#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á—ë—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–°–æ–∑–¥–∞—ë—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
"""

import os
import json
import yaml
from datetime import datetime
from typing import List, Dict, Any


class ReportGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á—ë—Ç–æ–≤ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    
    def __init__(self, config_path: str, results_dir: str):
        with open(config_path, 'r', encoding='utf-8') as f:
            self.config = yaml.safe_load(f)
        
        self.results_dir = results_dir
        self.app_name = self.config['target_application']['name']
        self.app_version = self.config['target_application']['version']
        
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        self.entrypoints = self._load_json('entrypoints.json')
        self.dataflows = self._load_json('dataflows.json')
        self.filtered_flows = self._load_json('filtered_flows.json')
        self.discarded_flows = self._load_json('discarded_flows.json')
        self.vulnerabilities = self._load_json('vulnerabilities.json')
        self.chains = self._load_json('exploit_chains.json', required=False)
    
    def _load_json(self, filename: str, required: bool = True) -> Dict:
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON-—Ñ–∞–π–ª"""
        filepath = os.path.join(self.results_dir, filename)
        if not os.path.exists(filepath):
            if required:
                return {}
            return {}
        
        with open(filepath, 'r', encoding='utf-8') as f:
            return json.load(f)
    
    def generate_report(self, output_path: str):
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç"""
        print("[–û–¢–ß–Å–¢] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞...")
        
        report = []
        
        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        report.append(self._generate_header())
        
        # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ
        report.append(self._generate_executive_summary())
        
        # –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è
        report.append(self._generate_methodology())
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
        report.append(self._generate_statistics())
        
        # –ö–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞
        report.append(self._generate_entrypoints_section())
        
        # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
        report.append(self._generate_vulnerabilities_section())
        
        # –¶–µ–ø–æ—á–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
        if self.chains and self.chains.get('total_chains', 0) > 0:
            report.append(self._generate_chains_section())
        
        # –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
        report.append(self._generate_conclusion())
        
        # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        report.append(self._generate_appendix())
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç
        full_report = '\n\n'.join(report)
        with open(output_path, 'w', encoding='utf-8') as f:
            f.write(full_report)
        
        print(f"[–û–¢–ß–Å–¢] –û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ {output_path}")
        return output_path
    
    def _generate_header(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫"""
        date = datetime.now().strftime('%d.%m.%Y')
        
        return f"""# –û–¢–ß–Å–¢ –ü–û –ê–£–î–ò–¢–£ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

## {self.app_name} –≤–µ—Ä—Å–∏—è {self.app_version}

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** {date}

**–¢–∏–ø –∞—É–¥–∏—Ç–∞:** White-box security audit (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π)

**–ê–Ω–∞–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** Security Audit Framework

---

## –í–ê–ñ–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï

–î–∞–Ω–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—ã–ª –ø—Ä–æ–≤–µ–¥—ë–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü—É —Å–∏—Å—Ç–µ–º—ã.

–í—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —è–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏, –¥–æ–∫–∞–∑—É–µ–º—ã–º–∏ –∏ –¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞.

–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–µ –∏–ª–∏ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ –¥–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç."""
    
    def _generate_executive_summary(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ"""
        total_vulns = self.vulnerabilities.get('total_vulnerabilities', 0)
        
        if total_vulns == 0:
            return """## –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –†–ï–ó–Æ–ú–ï

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª–Ω–æ–≥–æ white-box –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–Ω–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–æ–∫–∞–∑—É–µ–º–æ—Å—Ç–∏.

–í—Å–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –∏ —Ç–∞–º, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö —Å—Ç–æ–∫–æ–≤, –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã."""
        
        # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –ø–æ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏
        severities = {'CRITICAL': 0, 'HIGH': 0, 'MEDIUM': 0, 'LOW': 0}
        for vuln in self.vulnerabilities.get('vulnerabilities', []):
            sev = vuln.get('severity', 'MEDIUM')
            severities[sev] = severities.get(sev, 0) + 1
        
        summary = f"""## –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –†–ï–ó–Æ–ú–ï

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª–Ω–æ–≥–æ white-box –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **{self.app_name}** –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ **{total_vulns} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**.

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏

- üî¥ **CRITICAL:** {severities['CRITICAL']} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- üü† **HIGH:** {severities['HIGH']} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- üü° **MEDIUM:** {severities['MEDIUM']} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- üü¢ **LOW:** {severities['LOW']} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

"""
        
        # –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
        vuln_classes = {}
        for vuln in self.vulnerabilities.get('vulnerabilities', []):
            vclass = vuln.get('vulnerability_class', 'Unknown')
            vuln_classes[vclass] = vuln_classes.get(vclass, 0) + 1
        
        for vclass, count in sorted(vuln_classes.items(), key=lambda x: x[1], reverse=True):
            summary += f"- **{vclass}:** {count} —Å–ª—É—á–∞–µ–≤\n"
        
        return summary
    
    def _generate_methodology(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏"""
        return """## –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –ê–£–î–ò–¢–ê

–ê—É–¥–∏—Ç –ø—Ä–æ–≤–æ–¥–∏–ª—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç—Ä–æ–≥–æ–π 5-—Ñ–∞–∑–Ω–æ–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–µ–π:

### –§–∞–∑–∞ 1: –ö–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞
–ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–µ –¥–æ—Å—Ç–∏–∂–∏–º—ã—Ö —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞, –≤–∫–ª—é—á–∞—è:
- HTTP/HTTPS endpoints (–≤—Å–µ –º–µ—Ç–æ–¥—ã)
- Callback endpoints (webhooks, IPN)
- API endpoints
- AJAX handlers
- Admin endpoints
- Installer/Updater endpoints
- Cron/Worker endpoints

### –§–∞–∑–∞ 2: –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–æ —Å—Ç–æ–∫–∞ —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π:
- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
- –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è

### –§–∞–∑–∞ 3: –§–∏–ª—å—Ç—Ä —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è
–û—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Ç–æ–∫–∏, –≥–¥–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—ë–Ω —á–µ—Ä–µ–∑:
- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ç–∏–ø–∞–º (int, float, bool)
- Whitelist-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- –ü–æ–ª–Ω—É—é —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é

### –§–∞–∑–∞ 4: –ê–Ω–∞–ª–∏–∑ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏
–î–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø–æ—Ç–æ–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:
- –¢–æ—á–Ω—ã–π –∫–ª–∞—Å—Å —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- –£—Å–ª–æ–≤–∏–µ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
- –ù–∞–±–ª—é–¥–∞–µ–º–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ
- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

### –§–∞–∑–∞ 5: –ê–Ω–∞–ª–∏–∑ —Ü–µ–ø–æ—á–µ–∫
–°—Ç—Ä–æ—è—Ç—Å—è —Ü–µ–ø–æ—á–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –¥–æ–∫–∞–∑—É–µ–º.

## –ì–õ–û–ë–ê–õ–¨–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

- ‚ùå –°–ø–µ–∫—É–ª—è—Ü–∏–∏ –∏–ª–∏ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã
- ‚ùå Best practices –±–µ–∑ –¥–æ–∫–∞–∑—É–µ–º–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ, –¥–æ–∫–∞–∑—É–µ–º—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏"""
    
    def _generate_statistics(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–Ω–∞–ª–∏–∑–∞"""
        total_entrypoints = self.entrypoints.get('total_entrypoints', 0)
        total_dataflows = self.dataflows.get('total_dataflows', 0)
        total_filtered = self.filtered_flows.get('total_filtered_flows', 0)
        total_discarded = self.discarded_flows.get('total_discarded_flows', 0)
        total_vulns = self.vulnerabilities.get('total_vulnerabilities', 0)
        
        return f"""## –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–ù–ê–õ–ò–ó–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞ | {total_entrypoints} |
| –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö | {total_dataflows} |
| –ü–æ—Ç–æ–∫–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º | {total_filtered} |
| –ü–æ—Ç–æ–∫–æ–≤ —Å —É—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º | {total_discarded} |
| –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π | {total_vulns} |"""
    
    def _generate_entrypoints_section(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏—é –æ —Ç–æ—á–∫–∞—Ö –≤—Ö–æ–¥–∞"""
        entrypoints = self.entrypoints.get('entrypoints', [])
        
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
        by_transport = {}
        for ep in entrypoints:
            transport = ep.get('transport', 'Unknown')
            if transport not in by_transport:
                by_transport[transport] = []
            by_transport[transport].append(ep)
        
        section = """## –ö–ê–†–¢–ò–†–û–í–ê–ù–ò–ï –¢–û–ß–ï–ö –í–•–û–î–ê

### –û–±–∑–æ—Ä —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞ –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

"""
        
        for transport, eps in sorted(by_transport.items()):
            section += f"\n#### {transport} ({len(eps)} endpoints)\n\n"
            for ep in eps[:10]:  # –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–µ 10
                auth = ep.get('authentication', 'none')
                methods = ', '.join(ep.get('methods', []))
                section += f"- `{ep['handler']}` - –ú–µ—Ç–æ–¥—ã: {methods}, –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: {auth}\n"
            
            if len(eps) > 10:
                section += f"\n_... –∏ –µ—â—ë {len(eps) - 10} endpoints_\n"
        
        return section
    
    def _generate_vulnerabilities_section(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏—é –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö"""
        vulns = self.vulnerabilities.get('vulnerabilities', [])
        
        if not vulns:
            return """## –ü–û–î–¢–í–ï–†–ñ–î–Å–ù–ù–´–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò

**–≠–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –Ω–µ –±—ã–ª–∏ –¥–æ–∫–∞–∑–∞–Ω—ã.**

–í—Å–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ª–∏–±–æ –∏–º–µ—é—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω—É—é –∑–∞—â–∏—Ç—É, –ª–∏–±–æ –Ω–µ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –æ–ø–∞—Å–Ω—ã—Ö —Å—Ç–æ–∫–æ–≤."""
        
        section = """## –ü–û–î–¢–í–ï–†–ñ–î–Å–ù–ù–´–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò

–°–ª–µ–¥—É—é—â–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±—ã–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∏ —è–≤–ª—è—é—Ç—Å—è —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã–º–∏:

---

"""
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏
        severity_order = {'CRITICAL': 0, 'HIGH': 1, 'MEDIUM': 2, 'LOW': 3}
        sorted_vulns = sorted(
            vulns,
            key=lambda v: severity_order.get(v.get('severity', 'MEDIUM'), 2)
        )
        
        for idx, vuln in enumerate(sorted_vulns, 1):
            section += self._format_vulnerability(idx, vuln)
        
        return section
    
    def _format_vulnerability(self, idx: int, vuln: Dict) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω—É —É—è–∑–≤–∏–º–æ—Å—Ç—å"""
        severity_emoji = {
            'CRITICAL': 'üî¥',
            'HIGH': 'üü†',
            'MEDIUM': 'üü°',
            'LOW': 'üü¢'
        }
        
        emoji = severity_emoji.get(vuln.get('severity', 'MEDIUM'), '‚ö™')
        
        vuln_text = f"""### {emoji} –£—è–∑–≤–∏–º–æ—Å—Ç—å #{idx}: {vuln['vulnerability_class']}

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** {vuln['severity']}
**–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** {vuln['confidence']}

#### –ó–∞—Ç—Ä–æ–Ω—É—Ç–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- **–§–∞–π–ª:** `{vuln['entrypoint']}`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä:** `{vuln['parameter']}`
- **–°—Ç–æ–∫:** `{vuln['sink_function']}()` (—Å—Ç—Ä–æ–∫–∞ {vuln['sink_line']})

#### –£—Å–ª–æ–≤–∏–µ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
{vuln['exploitation_condition']}

#### –ù–∞–±–ª—é–¥–∞–µ–º–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ
{vuln['observable_impact']}

#### –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–°–æ—Ö—Ä–∞–Ω—ë–Ω:** {vuln['user_control']}

**–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:** {', '.join(vuln['transformations']) if vuln['transformations'] else '–ù–µ—Ç'}

#### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
"""
        
        for evidence in vuln['proof_evidence']:
            vuln_text += f"- {evidence}\n"
        
        vuln_text += "\n#### –†–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\n"
        vuln_text += self._explain_real_impact(vuln)
        vuln_text += "\n\n---\n\n"
        
        return vuln_text
    
    def _explain_real_impact(self, vuln: Dict) -> str:
        """–û–±—ä—è—Å–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏"""
        vclass = vuln['vulnerability_class']
        
        impacts = {
            'SQL Injection': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö, –∑–∞–∫–∞–∑–∞—Ö –∏ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.',
            'Command Injection': '–ê—Ç–∞–∫—É—é—â–∏–π –ø–æ–ª—É—á–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã.',
            'Cross-Site Scripting (XSS)': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å JavaScript –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫—Ä–∞—Å—Ç—å —Å–µ—Å—Å–∏–∏, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–µ —Å–∞–π—Ç—ã –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.',
            'Local File Inclusion': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –ø–∞—Ä–æ–ª—è–º–∏ –∏ –∫–ª—é—á–∞–º–∏.',
            'Arbitrary File Write': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º–µ, –≤–∫–ª—é—á–∞—è –≤–µ–±-—à–µ–ª–ª—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∫–æ–¥–∞.',
            'Code Execution': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π PHP-–∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø–æ–ª—É—á–∞—è –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.',
            'Insecure File Upload': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Ñ–∞–π–ª—ã, –≤–∫–ª—é—á–∞—è –≤–µ–±-—à–µ–ª–ª—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∫–æ–¥–∞.',
            'Server-Side Request Forgery (SSRF)': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º, –æ–±—Ö–æ–¥—è —Å–µ—Ç–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.',
            'Path Traversal': '–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã –≤–Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≤–∫–ª—é—á–∞—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.'
        }
        
        return impacts.get(vclass, '–£—è–∑–≤–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.')
    
    def _generate_chains_section(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏—é –æ —Ü–µ–ø–æ—á–∫–∞—Ö"""
        chains = self.chains.get('chains', [])
        
        if not chains:
            return ""
        
        section = """## –¶–ï–ü–û–ß–ö–ò –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–ò

–°–ª–µ–¥—É—é—â–∏–µ —Ü–µ–ø–æ—á–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –±—ã–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –¥–æ–∫–∞–∑—É–µ–º:

---

"""
        
        for chain in chains:
            section += f"""### {chain['chain_id']}: {chain['final_impact']}

**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å:** {chain['overall_severity']}
**–î–æ–∫–∞–∑—É–µ–º–æ—Å—Ç—å:** {chain['provability']}

**–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞:** {', '.join(chain['entrypoints'])}

#### –®–∞–≥–∏ —Ü–µ–ø–æ—á–∫–∏:

"""
            for i, step in enumerate(chain['steps'], 1):
                section += f"{i}. **{step['step']}**\n"
                section += f"   - –≠—Ñ—Ñ–µ–∫—Ç: {step['effect']}\n"
                section += f"   - –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: {step['evidence']}\n\n"
            
            section += f"**–§–∏–Ω–∞–ª—å–Ω–æ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ:** {chain['final_impact']}\n\n"
            section += "---\n\n"
        
        return section
    
    def _generate_conclusion(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–ª—é—á–µ–Ω–∏–µ"""
        total_vulns = self.vulnerabilities.get('total_vulnerabilities', 0)
        
        if total_vulns == 0:
            return """## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–Ω–µ –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–≥–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–æ–∫–∞–∑—É–µ–º–æ—Å—Ç–∏.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å–ª–µ–¥–æ–≤–∞—Ç—å secure coding practices
2. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
3. –ü—Ä–æ–≤–æ–¥–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∞—É–¥–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. –í–Ω–µ–¥—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ CI/CD

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**"""
        
        # –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
        critical = sum(1 for v in self.vulnerabilities.get('vulnerabilities', [])
                      if v.get('severity') == 'CRITICAL')
        high = sum(1 for v in self.vulnerabilities.get('vulnerabilities', [])
                  if v.get('severity') == 'HIGH')
        
        conclusion = f"""## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **{self.app_name}** –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ **{total_vulns} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π**.

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏

"""
        
        if critical > 0:
            conclusion += f"‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {critical} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏, —Ç—Ä–µ–±—É—é—â–∏—Ö –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è.\n\n"
        
        if high > 0:
            conclusion += f"‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {high} —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤—ã—Å–æ–∫–æ–π —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏.\n\n"
        
        conclusion += """### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ** —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏
2. –í–Ω–µ–¥—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ—Ö SQL-–æ–ø–µ—Ä–∞—Ü–∏–π
3. –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤—Ö–æ–¥–æ–≤
4. –í–Ω–µ–¥—Ä–∏—Ç—å Content Security Policy –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS
5. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ –ø–æ —Ç–∏–ø—É –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
6. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –ø–æ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏
2. –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä–∞–º–∫–∞–º–∏
3. –í–Ω–µ–¥—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
5. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
6. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**"""
        
        return conclusion
    
    def _generate_appendix(self) -> str:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        return """## –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### A. –û—Ç–±—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–°–ª–µ–¥—É—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∏ –æ—Ç–±—Ä–æ—à–µ–Ω—ã –≤ —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—ë–Ω –∑–∞—â–∏—Ç–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏.

–°–º. `discarded_flows.json` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.

### B. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞—É–¥–∏—Ç–∞

–ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞—É–¥–∏—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–µ `config.yaml`.

### C. –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `results/`:
- `entrypoints.json` - –ö–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞
- `dataflows.json` - –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- `filtered_flows.json` - –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
- `vulnerabilities.json` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- `exploit_chains.json` - –¶–µ–ø–æ—á–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

---

*–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Security Audit Framework*"""


def main():
    import argparse
    
    parser = argparse.ArgumentParser(
        description='–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞'
    )
    parser.add_argument(
        '--config',
        default='config.yaml',
        help='–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏'
    )
    parser.add_argument(
        '--results-dir',
        default='results',
        help='–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏'
    )
    parser.add_argument(
        '--output',
        default='results/SECURITY_AUDIT_REPORT.md',
        help='–ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞'
    )
    
    args = parser.parse_args()
    
    # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
    generator = ReportGenerator(args.config, args.results_dir)
    report_path = generator.generate_report(args.output)
    
    print(f"\n[–û–¢–ß–Å–¢] –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω: {report_path}")


if __name__ == "__main__":
    main()
