"use strict";$((function(){var e=!1,t=function(e){var t=1,r=1;$("#inetmarke_single_form .receiver_data input").on("change",(function(e){var t=$(e.target).attr("name").replace(/receiver\[(.*)\]/,"receiver_$1"),n=$(e.target).val();$("span#"+t).toggle(n.length>0),"receiver_additional"!==t&&"receiver_company"!==t||(n+="<br>"),$("span#"+t).html(n)})),$("#inetmarke_single_form .receiver_data input").trigger("change"),$('#inetmarke_single_form select[name="receiver[country]"]').on("change",(function(e){var t,n=$('option[value="DEU"]:selected',e.target).length>0,a=$("option:selected",$(this)).text(),r=$('select[name="productCode"] option.preferred');$("span#receiver_country").html(a),$("#inetmarke_single_form option.dest_national").toggle(!0===n),$("#inetmarke_single_form option.dest_international").toggle(!1===n),t=r.filter(":enabled").length>0?r.attr("value"):!0===n?$('select[name="productCode"] option.dest_national:first').attr("value"):$('select[name="productCode"] option.dest_international:first').attr("value"),$('select[name="productCode"]').val(t),o()})),$('#inetmarke_single_form select[name="receiver[country]"]').trigger("change"),$('#inetmarke_single_form select[name="voucherLayout"]').on("change",(function(e){var t=$('#inetmarke_single_form select[name="voucherLayout"] option[value="FrankingZone"]:selected').length>0;$("#inetmarke_single_form .sender_line").toggle(!1===t),$("#inetmarke_single_form .receiver_block").toggle(!1===t)})),$('#inetmarke_single_form select[name="voucherLayout"]').trigger("change"),$('#inetmarke_single_form select[name="pageFormatID"]').on("change",(function(e){var n,i,o,l,s,c,d;for(i=$("#pagepos_widget"),n=$('#inetmarke_single_form select[name="pageFormatID"] option:selected').text().match(/.*\((\d+) x (\d+) .*/),t=n[1],r=n[2],i.empty(),o=$('<table id="pagepos_table"></table>'),c=1;c<=r;c++){for(l=$('<tr class="pagepos_'+c+'"></tr>'),d=1;d<=t;d++)s=$('<td class="col_'+d+'"><span>'+c+"_"+d+"</span></td>"),l.append(s);o.append(l)}i.append(o),$('input[name="position_labelx"]').val("1"),$('input[name="position_labely"]').val("1"),a(),$("#pagepos_table td").first().trigger("click"),"1"==t&&"1"==r?$(".pagepos").css("opacity","0.5"):$(".pagepos").css("opacity","1.0")})),$('#inetmarke_single_form select[name="pageFormatID"]').trigger("change"),$("#pagepos_table td").first().trigger("click"),$('input[name="position_labelx"]').change((function(e){parseInt($(this).val())>t&&$(this).val(t)})),$('input[name="position_labely"]').change((function(e){parseInt($(this).val())>r&&$(this).val(r)})),$('input[name="position_labelx"], input[name="position_labely"]').on("change",(function(e){n()})),$("#inetmarke_single_form .previewOption").on("change",(function(e){o()})),o()},n=function(){var e,t,n,a;e=$('input[name="position_labely"]').val(),t=$('input[name="position_labelx"]').val(),n=$("#pagepos_table tr:nth-child("+e+")"),a=$("td:nth-child("+t+")",n),$("#pagepos_table td").removeClass("selected"),a.addClass("selected")},a=function(){$("#pagepos_table td").on("click",(function(e){var t,n;n={x:(t=$("span",$(this)).text().match(/(\d+)_(\d+)/))[2],y:t[1]},$('input[name="position_labelx"]').val(n.x),$('input[name="position_labely"]').val(n.y),$("#pagepos_table td").removeClass("selected"),$(this).addClass("selected")}))},r=function(e){var n=$(this).serialize();return $.ajax({type:"POST",url:jse.core.config.get("appUrl")+"/admin/admin.php?do=InternetMarke/SetSessionCredentials",data:n,dataType:"json"}).done((function(e){"OK"===e.result?($("#inetmarke_modal_content").empty().addClass("inetmarke_loading"),$("#inetmarke_modal_content").load("admin.php?do=InternetMarke/CreateLabelForm&orders_id="+e.orders_id,(function(e,n,a){$("#inetmarke_modal_content").removeClass("inetmarke_loading"),$("#inetmarke_single_form").length>0&&t()}))):alert(e.error_message)})).fail((function(e){alert(jse.core.lang.translate("submit_error","internetmarke"))})),!1},i=function(t){var n=$("#inetmarke_single_form").serialize();return $("#inetmarke_modal_content").empty().addClass("inetmarke_loading"),$.ajax({type:"POST",url:jse.core.config.get("appUrl")+"/admin/admin.php?do=InternetMarke/CreateLabelFormSubmit",data:n,dataType:"json"}).done((function(t){$("#inetmarke_modal_content").removeClass("inetmarke_loading"),"OK"===t.result?$("#inetmarke_modal_content").load("admin.php?do=InternetMarke/ListVouchers&template_version=2&orders_id="+t.orders_id,(function(){l(),$(".inetmarke_vouchers a.iframedl:last").trigger("click"),e=!0})):(t.error_message?alert(t.error_message):alert(jse.core.lang.translate("submit_error","internetmarke")),$("#internetmarke_modal").dialog("close"))})).fail((function(e){e.error_message?alert(e.error_message):alert(jse.core.lang.translate("submit_error","internetmarke")),$("#internetmarke_modal").dialog("close")})),!1},o=function(){if(null===$('select[name="productCode"]').val()){var e=$('select[name="productCode"] option').not(":disabled").first().val();$('select[name="productCode"]').val(e)}var t=$("#inetmarke_single_form").serialize();$.ajax({type:"POST",url:jse.core.config.get("appUrl")+"/admin/admin.php?do=InternetMarke/PreviewVoucher",data:t,dataType:"json"}).done((function(e){if("OK"===e.result)if($("#inetmarke_preview img").length>0)$("#inetmarke_preview img").attr("src",e.previewlink);else{var t=$('<img src="'+e.previewlink+'">');$("#inetmarke_preview").empty().append(t).show()}else e.error_message&&alert(e.error_message)})).fail((function(e){alert(jse.core.lang.translate("submit_error","internetmarke"))}))},l=function(){$("#inetmarke_modal_content").removeClass("inetmarke_loading"),$("#inetmarke_create_label").hide(),$("#inetmarke_showVoucherList").hide()},s=function(n){var a=$(n.target).parents("tr").attr("id")||$("body").find("#gm_order_id").val();$("#inetmarke_modal_content").empty().addClass("inetmarke_loading");var o=[];o.push({text:jse.core.lang.translate("close","buttons"),class:"btn",click:function(){$(this).dialog("close")}}),o.push({text:jse.core.lang.translate("create_voucher","internetmarke"),class:"btn btn-primary",click:i,id:"inetmarke_create_label"}),o.push({text:jse.core.lang.translate("show_vouchers","internetmarke"),class:"btn",click:function(e){e.preventDefault(),$("#inetmarke_modal_content").empty().addClass("inetmarke_loading"),$("#inetmarke_modal_content").load("admin.php?do=InternetMarke/ListVouchers&template_version=2&orders_id="+a,l)},id:"inetmarke_showVoucherList"}),$("#internetmarke_modal").dialog({autoOpen:!1,modal:!0,title:jse.core.lang.translate("create_label","internetmarke"),dialogClass:"internetmarke-modal",buttons:o,width:1200,position:{my:"center top",at:"center bottom",of:"#main-header"},close:function(t,n){e?(console.info("reloading"),location.reload()):console.info("not reloading")}}),$("#internetmarke_modal").dialog("open"),$("#inetmarke_modal_content").load("admin.php?do=InternetMarke/CreateLabelForm&template_version=2&orders_id="+a,(function(e,n,a){$("#inetmarke_modal_content").removeClass("inetmarke_loading"),$("#inetmarke_single_form").length>0&&t(),$("#inetmarke_enter_credentials").length>0&&($("#inetmarke_enter_credentials").on("submit",r),$("#tos_accepted").on("change",(function(e){!0===$("#tos_accepted").get(0).checked?$("#submit_session_credentials").removeAttr("disabled"):$("#submit_session_credentials").attr("disabled","disabled")})),$("#tos_accepted").trigger("change")),$("#inetmarke_balance_too_low").length>0&&$("#internetmarke_modal").dialog("option","buttons",[{text:jse.core.lang.translate("close","buttons"),class:"btn",click:function(){$("#internetmarke_modal").dialog("close")}}])}))},c=$(".orders .table-main");$("body").prepend($('<div id="internetmarke_modal" title="'+jse.core.lang.translate("create_label_window_title","internetmarke")+'" style="display: none;"><div id="inetmarke_modal_content"></div></div>')),c.on("init.dt",(function(){var e=function(e){e.find("tbody .btn-group.dropdown").each((function(t,n){var a=$(this).parents("tr").data("id"),r=e.data("defaultRowAction")||"edit";jse.libs.button_dropdown.addAction($(n),{text:jse.core.lang.translate("create_label","internetmarke"),href:jse.core.config.get("appUrl")+"/admin/dummy.php?orders_id="+a,class:"internetmarke-single",data:{configurationValue:"internetmarke-single"},isDefault:"internetmarke-single"===r,callback:function(e){e.preventDefault(),s(e)}})}))};c.on("draw.dt",(function(){return e(c)})),e(c)}))}));