"use strict";!function(){var t={container:document.querySelector("#account-iframe-container"),iframe:null},e={created:"hub:account:created",updated:"hub:account:updated",disconnected:"hub:account:disconnected",payment_modules_redirect:"hub:account:payment_modules:redirect"},n={shopData:"shop:transfer:shopData"},a={translations:null,shopData:null},o={translations:null,shopData:null},i=(navigator.userAgent.indexOf("MSIE"),void 0);function r(t,e){if(window.$&&window.$.ui){var n=$("<div/>",{class:"gambio-hub-modal gx-container",html:e});n.dialog({title:t,buttons:[{text:"OK",click:function(){return n.dialog("close")}}],close:function(){return n.remove()}}),n.parents(".ui-dialog").addClass("gx-container");var a=n.parents(".ui-dialog").find(".ui-icon.ui-icon-closethick");a.length&&a.remove()}else alert(t+" - "+e)}function u(){var t=new Request(a.shopData,{credentials:"include"});return window.fetch(t).then((function(t){return t.json()})).then((function(t){return o.shopData=t})).catch((function(){return r(o.translations.ERROR,o.translations.GET_SHOP_DATA_ERROR)}))}function c(){var e={type:n.shopData,data:o.shopData};t.iframe.contentWindow.postMessage(e,"*")}function d(){var t;window.iFrameResize({heightCalculationMethod:"grow"},"#account-iframe"),(t=new Request(a.translations,{credentials:"include"}),window.fetch(t).then((function(t){return t.json()})).then((function(t){return o.translations=t})).catch((function(){return r("Error","The page translations couldn't be loaded.")}))).then(u).then(c)}var s=null!==t.container.getAttribute("data-autostart")?"DOMContentLoaded":"hub:account:start";window.addEventListener(s,(function(){i=null!==t.container.getAttribute("data-legacy-mode"),a.translations=i?"request_port.php?module=HubConfiguration&action=get_translations":"admin.php?do=HubConfigurationAjax/GetTranslations",a.shopData=i?"request_port.php?module=HubConfiguration&action=get_shop_data":"admin.php?do=HubConfigurationAjax/GetShopData",t.iframe=document.createElement("iframe"),t.iframe.setAttribute("src",t.container.getAttribute("data-target")),t.iframe.setAttribute("id","account-iframe"),t.iframe.classList.add("hub-iframe"),t.iframe.addEventListener("load",d),t.container.appendChild(t.iframe),t.container.removeAttribute("data-target"),t.container.removeAttribute("data-autostart"),t.container.removeAttribute("data-legacy-mode")})),window.addEventListener("message",(function(t){if(t.data.type)switch(t.data.type){case e.disconnected:$.ajax({type:"POST",url:"admin.php?do=HubConfigurationAjax/deleteClientKey"}).done((function(t){setTimeout((function(){return window.location.reload()}),1500)}));break;case e.created:case e.updated:setTimeout((function(){return window.location.reload()}),1500);break;case e.payment_modules_redirect:setTimeout((function(){window.location.href=jse.core.config.get("appUrl")+"/admin/admin.php?do=HubConfiguration/PaymentMethods&action=install:"+t.data.getParam}),1500)}}))}();