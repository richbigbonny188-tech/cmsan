"use strict";!function(){var t={container:document.querySelector("#payment-methods-iframe-container"),iframe:null,accountContainer:document.querySelector("#account-iframe-container"),accountIframe:null,accountModal:document.querySelector("#account-modal")},e="Authorization",n="OrderStatuses",a="StyleConfig",o="Reload",i="Action",r={shopData:null,createSessionKey:null,translations:null,orderStatuses:null,styleConfig:null},s={translations:null,shopData:null,sessionKey:null,languageCode:null,orderStatuses:null,styleConfig:null},u=void 0;function c(t){if(!t.ok)throw new Error(t);return t}function l(t,e){if(window.$&&window.$.ui){var n=$("<div/>",{class:"gambio-hub-modal",html:e});n.dialog({title:t,buttons:[{text:"OK",click:function(){return n.dialog("close")}}],close:function(){return n.remove()}}),n.parents(".ui-dialog").addClass("gx-container");var a=n.parents(".ui-dialog").find(".ui-icon.ui-icon-closethick");a.length&&a.remove()}else alert(t+" - "+e)}function d(){var t=new Request(r.shopData,{credentials:"include"});return window.fetch(t).then(c).then((function(t){return t.json()})).then((function(t){return s.shopData=t})).catch((function(){return l(s.translations.ERROR,s.translations.GET_SHOP_DATA_ERROR)}))}function h(){var t=new Request(r.orderStatuses,{credentials:"include"});return window.fetch(t).then(c).then((function(t){return t.json()})).then((function(t){return s.orderStatuses=t})).catch((function(){return l(s.translations.ERROR,s.translations.GET_ORDER_STATUS_ERROR)}))}function f(){var t=new Request(r.styleConfig,{credentials:"include"});return window.fetch(t).then(c).then((function(t){return t.json()})).then((function(t){return s.styleConfig=t})).catch((function(){return l(s.translations.ERROR,s.translations.GET_SHOP_DATA_ERROR)}))}function m(){if(!s.shopData.clientkey||!s.sessionKey)return t.iframe.removeEventListener("load",p),void(t.iframe.src+="&demo");var o=[{channel:e,message:{clientKey:s.shopData.clientkey,sessionKey:s.sessionKey}},{channel:n,message:s.orderStatuses},{channel:a,message:s.styleConfig}],r=location.search.slice(1).split("&").filter((function(t){return t.indexOf("action=")>-1}));if(r.length){var u=r[0].split("=").pop().split(":");o.push({channel:i,message:{name:u[0],value:u[1]}}),history.pushState({},"",jse.core.config.get("appUrl")+"/admin/admin.php?do=HubConfiguration/PaymentMethods")}t.iframe.contentWindow.postMessage(o,"*")}function g(){if(s.shopData&&s.shopData.clientkey){var t=new Request(r.createSessionKey,{method:"POST",credentials:"include"});return window.fetch(t).then(c).then((function(t){return t.json()})).then((function(t){return s.sessionKey=t.gambio_hub_session_key})).catch((function(){return l(s.translations.ERROR,s.translations.CREATE_SESSION_ERROR)}))}}function p(){var t;window.iFrameResize({heightCalculationMethod:"grow"},"#payment-methods-iframe"),(t=new Request(r.translations,{credentials:"include"}),window.fetch(t).then(c).then((function(t){return t.json()})).then((function(t){return s.translations=t})).catch((function(){return l("Error","The page translations couldn't be loaded.")}))).then(d).then(h).then(f).then(g).then(m)}var y=null!==t.container.getAttribute("data-autostart")?"DOMContentLoaded":"hub:payment_methods:start";window.addEventListener(y,(function(){u=null!==t.container.getAttribute("data-legacy-mode"),s.languageCode=u?js_options.global.language_code:window.jse.core.config.get("languageCode"),r.translations=u?"request_port.php?module=HubConfiguration&action=get_translations":"admin.php?do=HubConfigurationAjax/GetTranslations",r.shopData=u?"request_port.php?module=HubConfiguration&action=get_shop_data":"admin.php?do=HubConfigurationAjax/GetShopData",r.createSessionKey=u?"request_port.php?module=HubConfiguration&action=create_session_key":"admin.php?do=HubConfigurationAjax/CreateSessionKey",r.orderStatuses=u?"request_port.php?module=HubConfiguration&action=get_order_statuses":"admin.php?do=HubConfigurationAjax/GetOrderStatuses",r.styleConfig=u?"request_port.php?module=HubConfiguration&action=get_style_edit_configuration":"admin.php?do=HubConfigurationAjax/GetStyleEditConfiguration",t.iframe=document.createElement("iframe"),t.iframe.setAttribute("src",t.container.getAttribute("data-target")),t.iframe.setAttribute("id","payment-methods-iframe"),t.iframe.classList.add("hub-iframe"),t.iframe.addEventListener("load",p),t.container.appendChild(t.iframe),t.container.removeAttribute("data-target"),t.container.removeAttribute("data-autostart"),t.container.removeAttribute("data-legacy-mode");var e=document.createEvent("Event");e.initEvent("hub:account:start",!0,!1),window.dispatchEvent(e)})),window.addEventListener("message",(function(e){if(function(t){return Array.isArray(t.data)&&t.data.length&&Object.keys(t.data[0]).includes("channel")&&Object.keys(t.data[0]).includes("message")}(e)){var n=e.data[0];n.channel.startsWith("Modal")&&n.message.startsWith("registration")&&(u?$(t.accountModal).dialog({minWidth:800,minHeight:700,class:"gx-container"}):$(t.accountModal).modal()),n.channel.startsWith(o)&&window.location.reload()}}))}();