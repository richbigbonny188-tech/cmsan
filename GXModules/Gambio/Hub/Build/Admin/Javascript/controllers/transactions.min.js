"use strict";!function(){var e={iframe:null,container:null},n="DOMContentLoaded",t="load",a="message",o="Authorization",i="Reload",r={iframe:"https://dev-gui.gambiohub.com?section=transactions",shopData:null,createSessionKey:null,translations:null},s={translations:null,shopData:null,sessionKey:null,languageCode:null},u={heightCalculationMethod:-1!==navigator.userAgent.indexOf("MSIE")?"max":"lowestElement"},c=void 0;function l(e){if(!e.ok)throw new Error(e);return e}function d(e,n){if(window.$&&window.$.ui){var t=$("<div/>",{class:classes.modal,html:n});t.dialog({title:e,buttons:[{text:"OK",click:function(){return t.dialog("close")}}],close:function(){return t.remove()}})}else alert(e+" - "+n)}function h(){var e=new Request(r.shopData,{credentials:"include"});return window.fetch(e).then(l).then((function(e){return e.json()})).then((function(e){return s.shopData=e})).catch((function(){return d(s.translations.ERROR,s.translations.GET_SHOP_DATA_ERROR)}))}function f(){if(s.shopData&&s.shopData.clientkey){var e=new Request(r.createSessionKey,{method:"POST",credentials:"include"});return window.fetch(e).then(l).then((function(e){return e.json()})).then((function(e){return s.sessionKey=e.gambio_hub_session_key})).catch((function(){return d(s.translations.ERROR,s.translations.CREATE_SESSION_ERROR)}))}}function m(){if(!s.shopData.clientkey||!s.sessionKey)return e.iframe.removeEventListener(t,onIframeLoaded),void(e.iframe.src=r.iframe+"&demo");var n=[{channel:o,message:{clientKey:s.shopData.clientkey,sessionKey:s.sessionKey}}];e.iframe.contentWindow.postMessage(n,"*")}function g(){var e;window.iFrameResize(u),(e=new Request(r.translations,{credentials:"include"}),window.fetch(e).then(l).then((function(e){return e.json()})).then((function(e){return s.translations=e})).catch((function(){return d("Error","The page translations couldn't be loaded.")}))).then(h).then(f).then(m)}e.iframe=document.createElement("iframe"),window.addEventListener(n,(function(){c=!window.jse,s.languageCode=c?"de":window.jse.core.config.get("languageCode"),r.iframe+="?language="+s.languageCode,e.container=document.querySelector("#iframe-container"),r.translations=c?"request_port.php?module=HubConfiguration&action=get_translations":"admin.php?do=HubConfigurationAjax/GetTranslations",r.shopData=c?"request_port.php?module=HubConfiguration&action=get_shop_data":"admin.php?do=HubConfigurationAjax/GetShopData",r.createSessionKey=c?"request_port.php?module=HubConfiguration&action=create_session_key":"admin.php?do=HubConfigurationAjax/CreateSessionKey",e.iframe.src=r.iframe,e.iframe.addEventListener(t,g),e.container.appendChild(e.iframe)})),window.addEventListener(a,(function(e){(function(e){return Array.isArray(e.data)&&e.data.length&&Object.keys(e.data[0]).includes("channel")&&Object.keys(e.data[0]).includes("message")})(e)&&e.data[0].channel.startsWith(i)&&window.location.reload()}))}();