"use strict";!function(){var n=function(n,a,t,o){var r=KlarnaHub.Config.klarnaOrder.order_lines.find((function(a){return a.reference===n})),e=r?Math.abs(r.total_amount)/100:0;r&&KlarnaHub.Config.klarnaOrder.refunds.forEach((function(a){a.order_lines.forEach((function(a){a.reference===n&&(e=Math.abs(a.total_amount/100))}))}));var i=e.toLocaleString(KlarnaHub.Config.klarnaOrder.locale,{style:"currency",currency:KlarnaHub.Config.klarnaOrder.purchase_currency,currencyDisplay:"code",useGrouping:!1}).replace(",","."),l=[];return l.push($("<div/>",{class:"control-group",html:[$("<label/>",{text:a,style:"width:70%"}),$("<span/>",{text:i})]})),l.push($("<div/>",{class:"control-group",html:[$("<label/>",{text:t,style:"width:70%"}),$("<div/>",{class:"input-group",html:[$("<input/>",{class:o,value:i.replace(/[^\d.-]/g,"")}),$("<div/>",{class:"input-group-addon",text:i.replace(/[\d.-]/g,"")})]})]})),l};$(document).on("JSENGINE_INIT_FINISHED",(function(){return $('[name="recalculate"]').prop("checked",!0).trigger("change")})),$(document).on("ready",(function(){return $('.bottom-save-bar input:button, form[name="save_order"] input:submit').prop("disabled",!0)})),KlarnaHub.on("ready",(function(){return function(){var a=$('[name="save_order"]'),t=$('[name="recalculate"]'),o=[];KlarnaHub.Config.giftSystem&&(o=(o=(o=o.concat(n("ot_coupon",KlarnaHub.Config.lang.OLD_COUPON_AMOUNT,KlarnaHub.Config.lang.NEW_COUPON_AMOUNT,"new-coupon-amount"))).concat(n("ot_discount",KlarnaHub.Config.lang.OLD_DISCOUNT_AMOUNT,KlarnaHub.Config.lang.NEW_DISCOUNT_AMOUNT,"new-discount-amount"))).concat(n("ot_gv",KlarnaHub.Config.lang.OLD_VOUCHER_AMOUNT,KlarnaHub.Config.lang.NEW_VOUCHER_AMOUNT,"new-voucher-amount"))),o=o.concat(n("ot_shipping",KlarnaHub.Config.lang.OLD_SHIPPING_COSTS,KlarnaHub.Config.lang.NEW_SHIPPING_COSTS,"new-shipping-costs"));var r=$("<div/>",{html:o}).appendTo("body");r.dialog({autoOpen:!1,width:500,height:"auto",resizable:!1,modal:!0,title:"Klarna",dialogClass:"gx-container additional-costs-dialog ",buttons:[{text:KlarnaHub.Config.lang.CLOSE,click:function(){return r.dialog("close")}},{text:KlarnaHub.Config.lang.NOTIFY_KLARNA,click:function(){r.find(".validate").remove("validate error");var n=function(n,a){var t=KlarnaHub.Config.klarnaOrder.order_lines.find((function(n){return n.reference===a})),o=t?Math.abs(t.total_amount)/100:0,e=r.find("."+n),i=e.length?e.val().replace(",","."):o;return i&&isNaN(i)&&e.addClass("validate error"),i},t=n("new-coupon-amount","ot_coupon"),o=n("new-discount-amount","ot_discount"),e=n("new-voucher-amount","ot_gv"),i=n("new-shipping-costs","ot_shipping");r.find(".validate.error").length||KlarnaHub.Api.activateRecalculationFlag(parseFloat(t),parseFloat(o),parseFloat(e),parseFloat(i)).then((function(){return a[0].submit()}))}}],open:function(){return $(".additional-costs-dialog .ui-dialog-buttonset button:last").addClass("btn btn-primary")}}),a.on("submit",(function(n){n.preventDefault(),t.prop("checked")?o.length?r.dialog("open"):KlarnaHub.Api.activateRecalculationFlag(0,0).then((function(){return a[0].submit()})):a[0].submit()})),$('.bottom-save-bar input:button, form[name="save_order"] input:submit').prop("disabled",!1)}()}))}();