"use strict";!function(){var n=function(n){var e=n.find("input:checkbox:checked").length+" "+KlarnaHub.Config.lang.SELECTED_ENTRIES;n.find("button:first").text(e)},e=function(n){var e=KlarnaHub.Config.lang.UNMATCHED_PRODUCT;if(!KlarnaHub.Config.order)return e;if("ot_shipping"===n.reference||"surcharge"===n.type)return n.name.replace(/:$/,"");var t=null!==n.merchant_data?n.merchant_data:n.reference;if(/\d+\D\d+/.test(t)||/\d+{\d+}\d+/.test(t)){var r=KlarnaHub.Config.order.items.find((function(n){return n.addonValues.identifier===t}));r&&(e=r.attributes.map((function(n){return n.name+": "+n.value})).join(", "))}return/^\d+$/.test(t)&&(e=""),n.name+(""!==e?" ("+e+")":"")},t=function(){var t=KlarnaHub.Config.klarnaOrder;if(t){var r=t.order_lines.filter((function(n){var e=function(n){return KlarnaHub.Config.klarnaOrder.captures.find((function(e){return e.order_lines.find((function(e){return null!==e.merchant_data?e.merchant_data===n.merchant_data:e.reference===n.reference}))}))}(n);return"ot_coupon"!==n.reference&&"ot_discount"!==n.reference&&"ot_gv"!==n.reference&&!e})),a=$("<div/>",{"data-gx-widget":"button_dropdown",html:[$("<div/>",{id:"klarna-selected-entries","data-use-button_dropdown":"true",css:{"margin-left":"0","margin-bottom":"0"},html:[$("<button/>",{text:"0 "+KlarnaHub.Config.lang.SELECTED_ENTRIES,on:{click:function(n){$(n.target).next("button").trigger("click")}}}),$("<ul/>",{html:r.map((function(t){return $("<li/>",{html:[$("<span/>",{html:[$("<input/>",{type:"checkbox",data:t,css:{height:"auto","margin-top":"5px"},prop:{checked:!0},on:{click:function(e){e.stopPropagation(),n(a)}}}),$("<span/>",{text:e(t),css:{display:"inline-block","padding-left":"5px"},on:{click:function(n){n.stopPropagation(),$(n.target).prev("input:checkbox").trigger("click")}}})]})]})}))})]})]});n(a);var i=$("<span/>",{text:KlarnaHub.Config.lang.ALL_ENTRIES_CAPTURED}),o=$("#update_orders_status_form"),d=o.find('[name="gm_status"]'),u=o.find('[name="gm_notify_klarna"]').closest(".control-group"),c=u.clone(!0);c.addClass("hidden"),c.find("label").text(KlarnaHub.Config.lang.KLARNA_CAPTURE),c.find(".single-checkbox").remove(),r.length?(c.append(a),gx.widgets.init(c)):c.append(i),c.insertBefore(u.next()),d.on("change",(function(n){n.target.value&&n.target.value==KlarnaHub.Config.orderStatusShipped?c.removeClass("hidden"):c.addClass("hidden")}))}};KlarnaHub.on("module",(function(n){"extend_order_status_modal"===n.module&&t()}))}();