{load_language_text section="cashflowtech"}
<style>
	#cft-collections table table tr {
		background-color: transparent;
	}
	#cft-collections table table tr td {
		padding: 0 5px;
		height: 38px;
	}
	#cft-collections div.alert {
		padding: 1.5ex 1ex;
		margin-bottom: 24px;
	}
	#cft-collections .btn-nomargin {
		margin: 0;
	}
</style>
<div id="cft-collections" class="collections">
	{if $content_data.cft_messages}
		{foreach $content_data.cft_messages as $message}
			<div class="alert alert-{$message.type}">
				{$message.content}
			</div>
		{/foreach}
	{/if}
	{foreach from=$content_data.collections item=collection}
		<table class="table-lg table-striped">
			<tbody>
				<tr>
					<td colspan="2"><strong>{$txt.base_data}</strong></td>
				</tr>
				{foreach $collection.details.base_data as $baseDataKey => $baseDataValue}
					{$baseDataKeyLabel="base_data_{$baseDataKey}"}
					<tr>
						<td>{$txt.$baseDataKeyLabel}</td>
						<td>{$baseDataValue}</td>
					</tr>
				{/foreach}
				<tr>
					<td colspan="2"><strong>{$txt.detail_data} (ID {$collection.details.detail_data.id})</strong></td>
				</tr>
				<tr>
					<td>{$txt.detail_data_file_reference}</td>
					<td>
						{$collection.details.detail_data.file_reference_1} /
						{$collection.details.detail_data.file_reference_2} /
						{$collection.details.detail_data.file_reference_3}
					</td>
				</tr>
				<tr>
					<td>{$txt.detail_data_role}</td>
					<td>{$collection.details.detail_data.role}</td>
				</tr>
				<tr>
					<td>{$txt.detail_data_contact_data}</td>
					<td>
						{$collection.details.detail_data.contact_data.first_name}
						{$collection.details.detail_data.contact_data.last_name}<br>
						{$collection.details.detail_data.contact_data.street}
						{$collection.details.detail_data.contact_data.housenumber}<br>
						{$collection.details.detail_data.contact_data.postalcode}
						{$collection.details.detail_data.contact_data.city}<br>
						{$collection.details.detail_data.contact_data.country}
					</td>
				</tr>
				<tr>
					<td colspan="2"><strong>{$txt.bookings}</strong></td>
				</tr>
				{if !$collection.details.booking_data}
					<tr>
						<td colspan="2">{$txt.no_bookings}</td>
					</tr>
				{else}
					<tr>
						<td colspan="2">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>{$txt.booking_data_id}</th>
										<th>{$txt.booking_data_amount}</th>
										<th>{$txt.booking_data_created_at}</th>
										<th>{$txt.booking_data_type_id}</th>
										<th>{$txt.booking_data_type_description}</th>
										<th>{$txt.booking_data_reversal_of_id}</th>
									</tr>
								</thead>
								<tbody>
									{foreach from=$collection.details.booking_data item=bookingRow}
										<tr>
											<td>{$bookingRow.id}</td>
											<td>{$bookingRow.amount}</td>
											<td>{$bookingRow.created_at}</td>
											<td>{$bookingRow.type_id}</td>
											<td>{$bookingRow.type_description}</td>
											<td>{$bookingRow.reversal_of_id}</td>
										</tr>
										{if !$bookingRow.reversal_of_id && $bookingRow.type_description !== 'reversal'}
											<tr>
												<td colspan="6">
													<form method="post" class="form-inline">
														<input type="hidden" name="action" value="reverse-payment">
														<input type="hidden" name="collection_id" value="{$collection.details.detail_data.id}">
														<input type="hidden" name="foko_id" value="{$bookingRow.id}">
														<table>
															<tr>
																<td><label for="reverse_payment_amount" class="">{$txt.reverse_payment_amount}</label></td>
																<td>
																	<div class="input-group">
																		<input class="form-control" name="reverse_payment_amount" type="number" min="0.00" step="0.01" value="0.00" placeholder="0.00">
																		<div class="input-group-addon">EUR</div>
																	</div>
																</td>
																<td>
																	<button type="submit" class="btn btn-primary btn-nomargin">{$txt.reverse_payment_save}</button>
																</td>
															</tr>
														</table>
													</form>
												</td>
											</tr>
										{/if}
									{/foreach}
								</tbody>
							</table>
						</td>
					</tr>
				{/if}
				{if $collection.payment_data}
					<tr>
						<td colspan="2"><strong>{$txt.payment_data}</strong></td>
					</tr>
					<tr>
						<td colspan="2">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>{$txt.payment_data_id}</th>
										<th>{$txt.payment_data_amount}</th>
										<th>{$txt.payment_data_created_at}</th>
										<th>{$txt.payment_data_type_id}/{$txt.payment_data_type_description}</th>
										<th>{$txt.payment_data_reversal_of_id}</th>
										<th>{$txt.payment_data_booking_id_incoming}</th>
										<th>{$txt.payment_data_booking_id_used}</th>
									</tr>
								</thead>
								<tbody>
									{foreach from=$collection.payment_data item=paymentRow}
										<tr>
											<td>{$paymentRow.id}</td>
											<td>{$paymentRow.amount}</td>
											<td>{$paymentRow.created_at}</td>
											<td>{$paymentRow.type_id}/{$paymentRow.type_description}</td>
											<td>{$paymentRow.reversal_of_id}</td>
											<td>{$paymentRow.booking_id_incoming}</td>
											<td>{$paymentRow.booking_id_used}</td>
										</tr>
									{/foreach}
								</tbody>
							</table>
						</td>
					</tr>
				{/if}
				{if $collection.booking_data_relevant}
					<tr>
						<td colspan="2"><strong>{$txt.booking_data_relevant}</strong></td>
					</tr>
					<tr>
						<td colspan="2">
							<table class="table table-striped">
								<thead>
									<tr>
										<th><{$txt.booking_data_relevant_id}</th>
										<th><{$txt.booking_data_relevant_amount}</th>
										<th><{$txt.booking_data_relevant_created_at}</th>
										<th><{$txt.booking_data_relevant_type_id}</th>
										<th><{$txt.booking_data_relevant_type_description}</th>
										<th><{$txt.booking_data_relevant_reversal_of_id}</th>
									</tr>
								</thead>
								<tbody>
									{foreach from=$collection.booking_data_relevant item=bookingRelevantRow}
										<tr>
											<td>{$bookingRelevantRow.id}</td>
											<td>{$bookingRelevantRow.amount}</td>
											<td>{$bookingRelevantRow.created_at}</td>
											<td>{$bookingRelevantRow.type_id}</td>
											<td>{$bookingRelevantRow.type_description}</td>
											<td>{$bookingRelevantRow.reversal_of_id}</td>
										</tr>
									{/foreach}
								</tbody>
							</table>
						</td>
					</tr>
				{/if}
				{if $collection.payment_data_relevant}
					<tr>
						<td colspan="2"><strong>{$txt.payment_data_relevant}</strong></td>
					</tr>
					<tr>
						<td colspan="2">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>{$txt.payment_data_relevant_id}</th>
										<th>{$txt.payment_data_relevant_amount}</th>
										<th>{$txt.payment_data_relevant_created_at}</th>
										<th>{$txt.payment_data_relevant_type_id}/{$txt.payment_data_relevant_type_description}</th>
										<th>{$txt.payment_data_relevant_reversal_of_id}</th>
										<th>{$txt.payment_data_relevant_booking_id_incoming}</th>
										<th>{$txt.payment_data_relevant_booking_id_used}</th>
									</tr>
								</thead>
								<tbody>
									{foreach from=$collection.payment_data_relevant item=paymentRelevantRow}
										<tr>
											<td>{$paymentRelevantRow.id}</td>
											<td>{$paymentRelevantRow.amount}</td>
											<td>{$paymentRelevantRow.created_at}</td>
											<td>{$paymentRelevantRow.type_id}/{$paymentRelevantRow.type_description}</td>
											<td>{$paymentRelevantRow.reversal_of_id}</td>
											<td>{$paymentRelevantRow.booking_id_incoming}</td>
											<td>{$paymentRelevantRow.booking_id_used}</td>
										</tr>
									{/foreach}
								</tbody>
							</table>
						</td>
					</tr>
				{/if}
				<tr>
					<td colspan="2"><br><strong>{$txt.new_payment}</strong></td>
				</tr>
				<tr>
					<td>
						{$txt.new_payment}
					</td>
					<td>
						<form method="post" class="form-horizontal">
							<input type="hidden" name="action" value="new-payment">
							<input type="hidden" name="order_id" value="{$content_data.orderId}">
							<input type="hidden" name="collection_id" value="{$collection.details.detail_data.id}">
							<table>
								<tr>
									<td><label for="new_payment_amount" class="">{$txt.new_payment_amount}</label></td>
									<td>
										<div class="input-group">
											<input class="form-control" name="new_payment[amount]" type="number" min="0.00" step="0.01" value="0.00" placeholder="0.00">
											<div class="input-group-addon">EUR</div>
										</div>
									</td>
								</tr>
								<tr>
									<td><label for="new_payment_type" class="">{$txt.new_payment_type}</label></td>
									<td>
										<select class="form-control" name="new_payment[type]">
											<option value="610">{$txt.new_payment_type_610}</option>
											<option value="600">{$txt.new_payment_type_600}</option>
											<option value="620">{$txt.new_payment_type_620}</option>
										</select>
									</td>
								</tr>
							</table>
							<button type="submit" class="pull-right btn btn-primary">{$txt.new_payment_save}</button>
						</form>
					</td>
				</tr>
			</tbody>
		</table>
	{/foreach}
</div>
