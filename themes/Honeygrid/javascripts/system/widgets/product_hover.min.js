"use strict";gambio.widgets.module("product_hover",[gambio.source+"/libs/events"],(function(e){var t=$(this),o=$(window),n=$("body"),r=null,i=null,a=null,s=0,c=$.extend(!0,{},{delay:50,flyoverClass:"flyover",scope:"",container:"#wrapper",productUrlSelector:".product-url"},e),l={},u=function(e){var t=n.children("."+c.flyoverClass);(t=e?t:t.filter(".product-hover-"+a)).remove()},d=function(e){e.preventDefault();var t=$(this),o=t.closest("."+c.flyoverClass),n=t.css("background-image"),r=(n=n.replace("/thumbnail_images/","/info_images/").replace("/gallery_images/","/thumbnail_images/").replace(/["']/gm,"")).match(/url\((.+)\)/);r&&r[1]&&(n=r[1]),n&&o.find(".product-hover-main-image img").attr("src",n)},f=function(e){e.stopPropagation(),i=i?clearTimeout(i):null,i=window.setTimeout(u,c.delay)},h=function e(o){o.stopPropagation();var s=$(this),l=null,h=n,p=s.data().uid||parseInt(1e4*Math.random(),10),m=h.children("."+c.flyoverClass+".product-hover-"+a+'[data-product_hover-uid="'+p+'"]'),g=s.offset();i=i?clearTimeout(i):null,s.hasClass(c.flyoverClass)||m.length||(u(!0),t.trigger(jse.libs.theme.events.OPEN_FLYOUT(),t),s.attr("data-product_hover-uid",p).data("uid",p),function(e){e.find(".thumbnails img").each((function(){var e=$(this),t=$("<img />"),o=e.data(),n=o.thumbSrc||o.src;t.on("load",(function(){e.closest("li").addClass("loaded").css({background:'#FFFFFF url("'+n+'") no-repeat center',"background-size":"contain"}).find("img, .align-helper").remove()})).attr("src",n)}))}(l=s.clone(!0)),l.addClass(c.flyoverClass+" product-hover-"+a).css({position:"absolute",left:g.left,top:g.top,width:s[0].getBoundingClientRect().width,height:s[0].getBoundingClientRect().height}),l.on("mouseenter",e).on("mouseleave",f).on("mouseenter",".thumbnails",d).on("click",v),n.append(l),r.offset().left>l.offset().left&&l.addClass("gallery-right"))},p=function(){n.children("."+c.flyoverClass+".product-hover-"+a).each((function(){var e=$(this),o=e.data().uid,n=t.find('[data-product_hover-uid="'+o+'"]'),r=n.offset();e.css({left:r.left,top:r.top,width:2*n.outerWidth()})}))},m=function(e,o){t!==o&&u()},v=function(e){var t=$(this);!1===$(this).hasClass("product-container")&&(t=$(this).closest(".product-container"));var o=t.find(c.productUrlSelector).first();function n(){if(o.length){var t=o.attr("href");if(void 0!==t){if(e.stopPropagation(),e.preventDefault(),(new Date).getTime()-s<100)return;switch(s=(new Date).getTime(),e.which){case 1:if(e.ctrlKey)return void window.open(t,"_blank");break;case 2:return void window.open(t,"_blank");case 3:return}location.href=t}}}jse.libs.hooks.execute(jse.libs.hooks.keys.shop.product.listing.hover,{container:t},500).then(n).catch(n)},g=function(e){e.stopPropagation()};return l.init=function(e){a=parseInt(1e4*Math.random(),10),r=$(c.container),t.on("touchstart",(function(){t.off("mouseenter mouseleave")})).on("touchend",(function(){t.off("mouseenter",c.scope+" .product-container",h).off("mouseleave",c.scope+" .product-container",f)})).on("mouseenter",c.scope+" .product-container",h).on("mouseleave",c.scope+" .product-container",f),t.find(".product-container .product-image").on("click mouseup",v),t.find(".product-container .product-image a").on("click mouseup",g),n.on(jse.libs.theme.events.OPEN_FLYOUT(),m),o.on("resize",p),e()},l}));