"use strict";gambio.widgets.module("parcelshopfinderresult",[],(function(e){$(this),$.extend(!0,{},{},e);var n={};return n.init=function(e){var n,t,a,o,s=function(){1==(!1===$("#psf_new_ab input").hasClass("invalid"))?$("#psf_make_new_ab_entry").removeAttr("disabled"):$("#psf_make_new_ab_entry").attr("disabled","disabled")};$("button.prepare_ab_entry").on("click",(function(e){e.preventDefault();var n,t=$(this).closest("tr"),a=$("strong.parcelshop_heading",t).text(),o=$("span.street_address",t).text(),i=$("span.house_number",t).text(),r=$("span.additional_info",t).text(),l=$("span.country_iso",t).text(),p=$("span.postcode",t).text(),m=$("span.city",t).text(),c=$("span.shop_name",t).text();"DE"!==l&&(r=r+" ("+c+")"),n=a,c.length>0&&(n+=", "+c),n+=", "+p+" "+m,$("#psf_name").val(n),$('#psf_new_ab input[name="street_address"]').val(o),$('#psf_new_ab input[name="house_number"]').val(i),$('#psf_new_ab input[name="additional_info"]').val(r),$('#psf_new_ab input[name="country"]').val(l),$('#psf_new_ab input[name="postcode"]').val(p),$('#psf_new_ab input[name="city"]').val(m),$("#psf_name").removeClass("invalid"),$("#psf_new_ab").show("fast",(function(){$("#psf_new_ab").get(0).scrollIntoView({behavior:"smooth",block:"end"})})),s()})),$('#psf_new_ab input[name="firstname"], #psf_new_ab input[name="lastname"]').on("keyup",(function(e){$(e.target).toggleClass("invalid",$(e.target).val().length<=2),s()})),$('#psf_new_ab input[name="postnumber"]').on("keyup",(function(e){$(this).val().length>5?$.ajax({url:jse.core.config.get("appUrl")+"/shop.php?do=Parcelshopfinder/ValidatePostnumber&postnumber="+$(this).val(),dataType:"json"}).done((function(e){$('#psf_new_ab input[name="postnumber"]').toggleClass("invalid",!0!==e.postnumberIsValid),s()})):($('#psf_new_ab input[name="postnumber"]').toggleClass("invalid",!0),s())})),$('#psf_new_ab input[name="postnumber"]').on("change",(function(e){$('#psf_new_ab input[name="postnumber"]').trigger("keyup")})),$("#psf_new_ab input").trigger("keyup"),"undefined"!=typeof psfDynamic&&!0===psfDynamic&&(o=[],(n=new google.maps.Map(document.getElementById("map"),{center:markerData[0].position,zoom:14})).addListener("click",(function(e){console.log(e),t.geocode({location:e.latLng},(function(e,t){if("OK"===t){if(console.log(e),"street_address"===e[0].types[0]){var o=e[0].formatted_address;a?(a.setPosition(e[0].geometry.location),a.setTitle(o)):a=new google.maps.Marker({map:n,position:e[0].geometry.location,title:o});var s=void 0,i=void 0,r=void 0,l=void 0,p=void 0;e[0].address_components.forEach((function(e){e.types.indexOf("street_number")>=0&&(i=e.long_name,$('input[name="house"]').val(i)),e.types.indexOf("route")>=0&&(s=e.long_name,$('input[name="street"]').val(s)),e.types.indexOf("postal_code")>=0&&(r=e.long_name,$('input[name="zip"]').val(r)),e.types.indexOf("locality")>=0&&(l=e.long_name,$('input[name="city"]').val(l)),e.types.indexOf("country")>=0&&(e.long_name,p=e.short_name,$('select[name="country"] option[value="'+p+'"]').length>0&&$('select[name="country"]').val(p))})),$("#psf-form").trigger("submit")}}else console.log("geocoder failed - "+t)}))})),markerData.forEach((function(e){e.map=n;var t=new google.maps.Marker(e);t.addListener("click",(function(n){var a=e.label,s=$("tr#marker_"+a),i=s.offset();$("html, body").animate({scrollTop:i.top-$("body").height()/2},500),s.addClass("marker_clicked"),$("tr.parcelshop").not(s).removeClass("marker_clicked"),o.forEach((function(e,n){e.setAnimation(null)})),t.setAnimation(google.maps.Animation.BOUNCE)})),o.push(t),$("#marker_"+e.label+" div.mapmarkerlabel_icon").on("click",(function(e){var a=$(this).closest("tr");n.setCenter(t.getPosition()),o.forEach((function(e,n){e.setAnimation(null)})),t.setAnimation(google.maps.Animation.BOUNCE),a.addClass("marker_clicked"),$("tr.parcelshop").not(a).removeClass("marker_clicked"),$("#map").get(0).scrollIntoView({behavior:"smooth",block:"end"})}))})),(t=new google.maps.Geocoder).geocode({address:searchAddress},(function(e,t){"OK"==t&&(n.setCenter(e[0].geometry.location),new google.maps.Marker({map:n,position:e[0].geometry.location}))}))),e()},n}));