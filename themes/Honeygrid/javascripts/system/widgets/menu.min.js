"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};gambio.widgets.module("menu",[gambio.source+"/libs/events",gambio.source+"/libs/responsive",gambio.source+"/libs/interaction"],(function(e){var t=$(this),n=$(window),o=$("body"),a=null,i=null,s=null,l=null,r=null,c=null,u=null,d=null,v=null,f=null,h=!1,p=null,m=null,b=!1,g=!1,y=null,C=null,T={},w=Modernizr.touchevents||-1!==navigator.userAgent.search(/Touch/i),k=$.extend({},{menuType:"horizontal",unfoldLevel:0,accordion:!1,showAllLink:!1,breakpoint:40,enterDelay:0,leaveDelay:50,widthTolerance:10,openClass:"open",switchElementPosition:!0,ignoreClass:"ignore-menu",touchMoveTolerance:10,openActive:!1,events:{desktop:["touch","hover"],mobile:["touch","click"]}},e),I={},N=function(){a=t.children("ul"),i=a.children("li").not(".navbar-topbar-item"),s=i.filter(".dropdown-more"),l=s.children("ul"),c=i.filter(".custom"),r=i.not(s),u=r.not(c)},O=function(e,t){var n=e.data("position"),o=!1;t.children().each((function(){var t=$(this);if(t.data("position")>n)return t.before(e.detach()),o=!0,!1})),o||t.append(e)},D=function(e){var t=!1,n=function(n){n.each((function(){var n=$(this),o=n.data().width;if(!(e>o))return t=!0,!1;O(n,a),e-=o}))};N(),n(l.children(".custom")),t||n(l.children());var o=0;l.children().each((function(){o+=$(this).data().width})),0===o?s.hide():o<s.data().width+e&&(s.hide(),e+=s.data().width,n(l.children()))},E=function(e){t.find("li."+k.openClass).each((function(){if($(this).parents(".navbar-categories-left").length>0)return!0;$(this).removeClass(k.openClass)})),!!("object"===(void 0===e?"undefined":_typeof(e)))&&e.hasOwnProperty("originalEvent")&&(e.stopPropagation(),e.preventDefault())},S=function(){p=p?clearTimeout(p):null,m=m?clearTimeout(m):null},P=function(){var e=a.width();i.filter("."+k.openClass).children("ul").each((function(){var t=$(this),n=t.parent();n.removeClass("flyout-right flyout-left flyout-center flyout-wont-fit");var o=t.outerWidth(),a=n.position().left,i=n.outerWidth();e>a+o?n.addClass("flyout-right"):a+i-o>0?n.addClass("flyout-left"):o<e?n.addClass("flyout-center"):n.addClass("flyout-wont-fit")}))},j=function(e,n){var o,i,r,d=t.innerWidth()-k.widthTolerance,f=0;"horizontal"!==k.menuType||v===d&&"switchedToDesktop"!==n||(a.children(":visible").each((function(){f+=$(this).data("width")})),d<f?(o=f-d,i=!1,r=function(e){e.each((function(){var e=$(this),t=e.data().width;if(e.filter("."+k.openClass).add(e.find("."+k.openClass)).removeClass(k.openClass),O(e,l),(o-=t)<0)return i=!0,!1}))},N(),s.is(":hidden")&&(o+=s.data().width,s.removeClass("style"),s.show()),r($(u.get().reverse())),i||r($(c.get().reverse()))):D(d-f),P(),v=d)},A=function(){if($(".level-1").css("padding-bottom",""),"vertical"===k.menuType){$("#categories nav.navbar-default:first").not(".nav-categories-left").length>0&&$("#categories nav.navbar-default:first").css({opacity:1,height:"auto"}).children().show();var e=t.find("li.topmenu-content").detach();$("#categories nav.navbar-default ul.level-1:first").append(e),t.appendTo(".box-categories"),t.removeClass("navbar-default navbar-categories"),t.find("ul.level-1").removeClass("navbar-nav"),t.find(".navbar-topbar-item").hide(),W(),o.trigger(jse.libs.theme.events.MENU_REPOSITIONED(),["switchedToDesktop"])}b||(i.each((function(e){var t=$(this),n=t.outerWidth();t.data({width:n,position:e})})),b=!0),"horizontal"===k.menuType&&(j(),w&&(a.find(".enter-category").show(),a.find(".dropdown > a").click((function(e){e.preventDefault()}))))},_=function(e,t){e.removeClass("touch mouse").addClass(t||"")},R=function(){var e=f||{},n=jse.libs.theme.responsive.breakpoint();if(n.id!==e.id){var a=n.id<=k.breakpoint&&(!h||void 0===e.id),i=n.id>k.breakpoint&&(h||void 0===e.id);h=n.id<=k.breakpoint,f=$.extend({},n),a||i?(S(),"vertical"!==k.menuType&&E(),k.switchElementPosition?a?(v=-1,D(99999999),$(".level-1").css("padding-bottom","200px"),"vertical"===k.menuType&&($("#categories nav.navbar-default:first").not(".nav-categories-left").length>0&&$("#categories nav.navbar-default:first").css({opacity:0,height:0}).children().hide(),t.find("ul.level-1 li.navbar-topbar-item:first").before($("#categories nav.navbar-default li.topmenu-content").detach()),t.appendTo("#categories > .navbar-collapse"),t.addClass("navbar-default navbar-categories"),t.find("ul.level-1").addClass("navbar-nav"),t.find(".navbar-topbar-item").not(".topbar-search").show(),L(),o.trigger(jse.libs.theme.events.MENU_REPOSITIONED(),["switchedToMobile"]))):A():P()):!h&&k.switchElementPosition?j():h||P()}},M=function(e,n,o){var i=$(this),s=i.children("ul.dropdown-menu"),l=s.length,r=s.length?s.data("level")||"0":99,c=parseInt(r,10)<=2&&f.id>k.breakpoint||f.id<=k.breakpoint;if("mobile"===n&&e.stopPropagation(),l&&c)if(e.preventDefault(),"mobile"===n)i.toggleClass(k.openClass);else{var u=i.hasClass(k.openClass),d=i.hasClass("leave"),v=e.data&&e.data.action?e.data.action:u&&d?"enter":u?"leave":"enter",h=$(".navbar-search-input-group .form-control.search-input");if(h.length&&h.is(":focus"))return;switch(v){case"enter":g||jse.libs.theme.interaction.isMouseDown()||(g=!0,S(),p=setTimeout((function(){a.find("."+k.openClass).not(i).not(i.parentsUntil(t,"."+k.openClass)).trigger(jse.libs.theme.events.TRANSITION_STOP(),[]).removeClass(k.openClass),a.find(".leave").trigger(jse.libs.theme.events.TRANSITION_STOP(),[]).removeClass("leave"),T.open=!0,i.off(jse.libs.theme.events.TRANSITION_FINISHED()).one(jse.libs.theme.events.TRANSITION_FINISHED(),(function(){g=!1})).trigger(jse.libs.theme.events.TRANSITION(),T).trigger(jse.libs.theme.events.OPEN_FLYOUT(),[t]),P()}),"number"==typeof o?o:k.enterDelay));break;case"leave":g=!1,S(),i.addClass("leave"),m=setTimeout((function(){T.open=!1,a.find("."+k.openClass).not(i.parentsUntil(t,"."+k.openClass)).off(jse.libs.theme.events.TRANSITION_FINISHED()).one(jse.libs.theme.events.TRANSITION_FINISHED(),(function(){_(i,""),i.removeClass("leave")})).trigger(jse.libs.theme.events.TRANSITION(),T)}),"number"==typeof o?o:k.leaveDelay)}}},U=function(e){var t=$(this),n=f.id<=k.breakpoint?"mobile":"desktop",o=k.events&&k.events[n]?k.events[n]:[];_(t,"mouse"),$.inArray(e.data.event,o)>-1&&M.call(t,e,n,e.data.delay),(t.hasClass("custom")||w&&0==t.children("ul").length)&&"click"===e.data.event&&!t.find("form").length&&(e.preventDefault(),e.stopPropagation(),"_blank"===t.find("a").attr("target")?window.open(t.find("a").attr("href")):location.href=t.find("a").attr("href"))},z=function(e){e.stopPropagation();var t=$(this),o=f.id<=k.breakpoint?"mobile":"desktop",i=k.events&&k.events[o]?k.events[o]:[];a.find(".enter-category").show(),a.find(".dropdown > a").on("click",(function(e){e.preventDefault()})),"start"===e.data.type?(y={event:e,timestamp:(new Date).getTime(),top:n.scrollTop()},a.off("mouseenter.menu mouseleave.menu")):$.inArray("touch",i)>-1&&!function(){C=C||y;var e=Math.abs(C.event.originalEvent.pageY-y.event.originalEvent.pageY);return C=null,e>k.touchMoveTolerance}()&&(_(t,"touch"),-1!==$.inArray("hover",i)&&"pointerdown"===d.start||M.call(t,e,o),a.on("mouseleave",(function(){a.on("mouseenter.menu","li",{event:"hover"},U).on("mouseleave.menu","li",{event:"hover",action:"leave"},U)})))},F=function(e){C={event:e,timestamp:(new Date).getTime(),top:n.scrollTop()}},x=function(e,n){n!==t&&0===t.find($(e.target)).length&&(S(),"horizontal"===k.menuType&&a.find(".touch, .mouse, .leave, ."+k.openClass).removeClass("touch mouse leave "+k.openClass))},H=function(e){e.preventDefault(),e.stopPropagation(),$(this).parents(".navbar-topbar-item").length>0||($(this).hasClass("dropdown")?$(this).hasClass(k.openClass)?$(this).removeClass(k.openClass).find("."+k.openClass).removeClass(k.openClass):$(this).addClass(k.openClass).parentsUntil(t,"li").addClass(k.openClass):location.href=$(this).find("a").attr("href"))},L=function(){a.on(d.start+".menu","li",{type:"start"},z).on(d.move+".menu","li",{type:"start"},F).on(d.end+".menu","li",{type:"end"},z).on("click.menu","li",{event:"click",delay:0},U).on("mouseenter.menu","li",{event:"hover",action:"enter"},U).on("mouseleave.menu","li",{event:"hover",action:"leave"},U),o.on(jse.libs.theme.events.MENU_REPOSITIONED(),j)},W=function(){a.off(d.start+".menu","li").off(d.move+".menu","li").off(d.end+".menu","li").off("click.menu","li").off("mouseenter.menu","li").off("mouseleave.menu","li")};return I.init=function(e){if(d=jse.core.config.get("touch"),T.classOpen=k.openClass,N(),t.css({overflow:"visible"}),o.on(jse.libs.theme.events.BREAKPOINT(),R).on(jse.libs.theme.events.OPEN_FLYOUT()+" click "+d.end,x),$(".close-menu-container").on("touchstart touchend click",E),$(".close-flyout").on("touchstart touchend click",E),"horizontal"===k.menuType&&L(),"vertical"===k.menuType&&(!0===k.accordion&&t.on("click","li",H),0===$("#categories").length)){$("#header").append('<div id="categories"><div class="navbar-collapse collapse"><nav class="navbar-default navbar-categories hidden"></nav></div></div>')}(R(),t.find("."+k.ignoreClass).on("mouseleave.menu mouseenter.menu click.menu "+d.start+" "+d.end,"li",(function(e){e.stopPropagation()})),k.openActive)&&t.find(".active").parentsUntil(t,"li").addClass("open");$("li.custom-entries a").on("click",(function(e){e.stopPropagation()})),"mobile"==(f.id<=k.breakpoint?"mobile":"desktop")&&$(".level-1").css("padding-bottom","200px"),e()},I}));