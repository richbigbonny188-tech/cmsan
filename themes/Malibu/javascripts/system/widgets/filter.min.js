"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};gambio.widgets.module("filter",["form","xhr"],(function(e){var t=$(this),i=$("body"),o=null,n=null,r=null,a=null,l=null,s=null,c=!1,p=!1,d=!1,u=$.extend(!0,{},{requestUrl:"shop.php?do=Filter",resetProductlistingFilter:!1,autoUpdate:!0,updateDelay:200,retries:2,retryDelay:500,selectorMapping:{filterForm:".filter-box-form-wrapper",productsContainer:".product-filter-target",filterSelectionContainer:".filter-selection-container",listingPagination:".productlisting-filter-container .panel-pagination",filterHiddenContainer:".productlisting-filter-container .productlisting-filter-hiddens",paginationInfo:".pagination-info"}},e),f={},h=function(e){var i="";s&&s.abort(),p&&(i="&reset=true"),s=$.ajax({url:u.requestUrl+"/GetListing&"+t.serialize()+i,method:"GET",dataType:"json"}).done((function(i){if(void 0===i.redirect){!d&&u.autoUpdate&&($(window).on("popstate",y),d=!0),jse.libs.theme.helpers.fill(i.content,n,u.selectorMapping);var o=$(u.selectorMapping.productsContainer);o.attr("data-gambio-widget","cart_handler"),gambio.widgets.init(o);var r=$(u.selectorMapping.productsContainer).parent("div");if(r.attr("data-gambio-widget","product_hover"),r.attr("data-product_hover-scope",".productlist-viewmode-grid"),gambio.widgets.init(r),c&&e){var a=decodeURIComponent(t.serialize());history.pushState({},"filter",location.origin+location.pathname+"?"+a+location.hash),t.trigger("pushstate",[])}else t.trigger("pushstate_no_history",[])}else location.href=i.redirect}))},g=function(e){e=void 0===e||!!e,function e(n,a,s){o.removeClass("error").show(),l&&l.abort(),l=jse.libs.xhr.ajax({url:u.requestUrl,data:a},!0).done((function(e){var n=$(e.content.filter.selector).find("input:checkbox").length,r=$(e.content.filter.selector);if(n){var a=$("<div/>").appendTo("body").hide();t.children().appendTo(a).clone().appendTo(t),jse.libs.theme.helpers.fill(e.content,a,u.selectorMapping),gambio.widgets.init(a);var l=setInterval((function(){a.find(".single-checkbox").length>0&&(t.children().remove(),a.children().appendTo(t),a.remove(),o.hide(),u.autoUpdate&&h(s),clearInterval(l))}),300)}else jse.libs.theme.helpers.fill(e.content,i,u.selectorMapping),gambio.widgets.init(r),o.hide(),u.autoUpdate&&h(s);-1!==location.href.search(/advanced_search_result\.php/g)&&$("h1").css("visibility","hidden"),window.gambio.widgets.init(t)})).fail((function(){n<u.retries?r=setTimeout((function(){e(n+1,a,s)}),u.retryDelay):o.addClass("error")}))}(0,function(e,t){var i=[];return $.each(e.filter_fv_id,(function(e,o){if(void 0!==o&&!1!==o)if("object"===(void 0===o?"undefined":_typeof(o))){var n=[];$.each(o,(function(e,t){!1!==t&&n.push(t)})),t?i.push(e+":"+n.join("|")):(i[e]=i[e]||[],i[e]=n)}else i.push(e+":"+o)})),e.filter_fv_id=t?i.join("&"):i,delete e.value_conjunction,e}(jse.libs.form.getData(t),!0),e)},m=function(e){p=!1,u.autoUpdate?(e.preventDefault(),e.stopPropagation(),$.magnificPopup.close()):u.resetProductlistingFilter||(jse.libs.form.addHiddenByUrl(t),$('input[name^="filter_fv_id"][type="hidden"]').remove())},b=function(e){e.preventDefault(),e.stopPropagation(),clearTimeout(a),clearTimeout(r),a=setTimeout(g,u.updateDelay)},v=function(e){if(e.preventDefault(),e.stopPropagation(),jse.libs.form.reset(t),jse.libs.form.addHiddenByUrl(t),p=!0,u.autoUpdate)g();else{var i=t.serialize().replace(/(value_conjunction|filter_price_min|filter_price_max)([^=]*=)[^&]*&/g,"$1$2&");location.href=location.pathname+"?"+i}},y=function(){jse.libs.form.reset(t),jse.libs.form.prefillForm(t,jse.libs.theme.helpers.getUrlParams()),g(!1)},_=function(){$(this).parent().removeClass("collapsed"),$(this).hide()},j=function(e){var t=$(this).attr("rel");e.preventDefault(),e.stopPropagation(),$("#"+t).prop("checked",!0).trigger("change")};return f.init=function(e){o=t.find(".preloader, .preloader-message"),n=$(".main-inside"),c=jse.core.config.get("history"),0===$(u.selectorMapping.productsContainer).length&&(u.autoUpdate=!1),t.on("change",'select, input[type="checkbox"], input[type="text"]',b).on("click",".btn-link",j).on("reset",v).on("submit",m).on("click",".show-more",_),i.addClass("filterbox-enabled"),e()},f}));