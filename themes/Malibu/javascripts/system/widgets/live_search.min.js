"use strict";gambio.widgets.module("live_search",["form","xhr",gambio.source+"/libs/events",gambio.source+"/libs/responsive"],(function(e){var n=$(this),t=$("body"),s=null,i=null,o=null,r=null,a=null,l={},u=$.extend(!0,{},{needle:3,target:".search-result-container",delay:200,url:"shop.php?do=LiveSearch",breakpoint:40,reopen:!0,classOpen:"open"},e),c={},f=function(e){var n=s.find("li"),t=n.eq(e);n.removeClass("active"),e>=0&&t.addClass("active")},p=function(e){var n=s.find("li"),t=n.filter(".active"),i=null,o=null;switch(e.keyCode){case 13:t.length&&(e.preventDefault(),e.stopPropagation(),o=t.find("a").attr("href"),location.href=o);break;case 38:i=t.length?t.index()-1:n.length-1,f(i);break;case 40:i=t.length?t.index()+1:0,f(i)}},d=function(){l.open=!1,s.off().one(jse.libs.theme.events.TRANSITION_FINISHED(),(function(){s.empty()})).trigger(jse.libs.theme.events.TRANSITION(),l),n.off("keydown.autosuggest")},g=function(e){if($.inArray(e.keyCode,[13,37,38,39,40])>-1)return!0;var t=jse.libs.form.getData(n);r&&clearTimeout(r),t.keywords.length<u.needle?d():r=setTimeout((function(){o&&o.abort(),o=jse.libs.xhr.post({url:u.url,data:t,dataType:"html"},!0).done((function(e){var t;e?(t=e,l.open=!0,s.html(t).trigger(jse.libs.theme.events.TRANSITION(),l),n.trigger(jse.libs.theme.events.OPEN_FLYOUT(),[n]),n.off("keydown.autosuggest").on("keydown.autosuggest",p)):d()}))}),u.delay)},h=function(){i.trigger("focus",[])},b=function(){var e=jse.libs.theme.responsive.breakpoint().id<=u.breakpoint&&!a,n=jse.libs.theme.responsive.breakpoint().id>u.breakpoint&&a;(e||n)&&s.removeClass(u.classOpen)},v=function(e,t){t===n||n.find($(e.target)).length||(s.removeClass(u.classOpen),i.trigger("blur",[]))};return c.init=function(e){var o=u.reopen?" focus":"";a=jse.libs.theme.responsive.breakpoint().id<=u.breakpoint,l.classOpen=u.classOpen,s=n.find(u.target),i=n.find("input"),s.hide(),t.on(jse.libs.theme.events.OPEN_FLYOUT()+" click",v).on(jse.libs.theme.events.BREAKPOINT(),b),n.on("keyup"+o,"input",g).on("change","select",h),e()},c}));