"use strict";gambio.widgets.module("cart_dropdown",["xhr",gambio.source+"/libs/events"],(function(e){var t=$(this),o=$(window),n=$("body"),r=null,s=null,i=!1,l=null,a=null,c=null,p={part1:"header",part2:"dropdown"},u={delay:5e3,url:"shop.php?do=CartDropdown",fillTarget:"header",countAnimation:2e3,selectorMapping:{cartDropdown:".cart-dropdown",cartDropdownProducts:".products",cartDropdownProductsCount:".cart-products-count"}},d=$.extend(!0,{},u,e),g={},f=function(){var e=t.find(".products-list"),o=2*e.outerHeight();e.animate({scrollTop:o+"px"},0)},m=function(e){e.stopPropagation(),"0"!==$(u.selectorMapping.cartDropdownProductsCount).text()&&$(u.selectorMapping.cartDropdownProductsCount).removeClass("hidden"),r.trigger("mouseenter",{prog:!0})},v=function(e){e.stopPropagation(),r.trigger("mouseleave",{prog:!0})},h=function(e,o){c&&c.abort(),c=jse.libs.xhr.ajax({url:d.url,data:p}).done((function(e){if(void 0===d.selectorMapping[e.content.count.selector])return jse.core.debug.warn('The selector mapping "'+e.content.count.selector+"\" doesn't exist."),!0;var n=$(d.selectorMapping[e.content.count.selector]).first().text();jse.libs.theme.helpers.fill(e.content,s,d.selectorMapping),function(e,t){if(void 0===d.selectorMapping[t.selector])return jse.core.debug.warn('The selector mapping "'+t.selector+"\" doesn't exist."),!0;var o=$(t.value).text(),n=s.find(d.selectorMapping[t.selector]);e!==o&&(a&&clearTimeout(a),t.value>99?n.addClass("over99"):n.removeClass("over99"),n.addClass("big"),a=setTimeout((function(){n.removeClass("big")}),d.countAnimation))}(n,e.content.count),f(),o&&(t.trigger(jse.libs.theme.events.CART_OPEN(),[]),l=setTimeout((function(){t.trigger(jse.libs.theme.events.CART_CLOSE(),[])}),d.delay))}))},C=function(e,t){t&&t.prog||!l||clearTimeout(l)},w=function e(){if(r.hasClass("open")){var t=$(d.selectorMapping.cartDropdown),o=t.offset();!i&&o.top<$(window).scrollTop()&&(t.css({position:"fixed",top:20,left:o.left}),i=!0),i&&o.top<r.offset().top&&(t.css({position:"",top:"",left:""}),i=!1)}else{var n=setInterval((function(){r.hasClass("open")&&(e(),clearInterval(n))}),100);i=!1}};return g.init=function(e){r=t.find("> ul > li"),s=d.fillTarget?$(d.fillTarget):t,o.on("scroll",w),n.on(jse.libs.theme.events.CART_OPEN(),m).on(jse.libs.theme.events.CART_CLOSE(),v).on(jse.libs.theme.events.CART_UPDATE(),h),r.on("mouseenter mouseleave",C).on("mouseenter",w),f(),-1!==location.search.search("open_cart_dropdown=1")&&n.trigger(jse.libs.theme.events.CART_OPEN()),e()},g}));