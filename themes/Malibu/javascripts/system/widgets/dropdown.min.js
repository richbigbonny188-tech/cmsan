"use strict";gambio.widgets.module("dropdown",[gambio.source+"/libs/events",gambio.source+"/libs/responsive"],(function(e){var n=$(this),t=$("body"),r={},i=$.extend(!0,{},{breakpoint:40,container:".custom-dropdown",openClass:"open",hideActive:!0,shorten:10,shortenOnInit:!1,shortenOnMobile:!1,triggerChange:!0,triggerNoChange:!1},e),o={},s=function(e,n,t){return(i.breakpoint<jse.libs.theme.responsive.breakpoint().id||t.shortenOnMobile)&&("fit"===t.shorten?n=function(e,n){var t=e.children().not(".dropdown-name"),r=e.children(".dropdown-name"),i=e.width(),o=n.length,s="",a=!1,l=0,d=null;for(t.each((function(){i-=$(this).outerWidth()}));l<o;l+=1){if(d=n.substring(0,l)+"...",r.text(d),r.width()>i){a=!0;break}s=d}return a?s:n}(e,n):t.shorten&&(n=function(e,n){var t=e.length,r=t-n.shorten;return r>0?(r+=3,e.substring(0,t-r)+"..."):e}(n,t))),n},a=function(){var e=$(this).closest(i.container),n=e.children("select"),t=$.extend({},i,e.parseModuleData("dropdown"));r.open=!1,e.trigger(jse.libs.theme.events.TRANSITION(),r),t.triggerNoChange&&n.trigger("change",[])},l=function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(i.container),o=t.children("select"),s=$.extend({},i,t.parseModuleData("dropdown"));t.hasClass(i.openClass)?(r.open=!1,t.trigger(jse.libs.theme.events.TRANSITION(),r),s.triggerNoChange&&o.trigger("change",[])):(!function(e,n){if(n.hideActive){var t=e.children("select").children(":selected").val();e.find("li").show().children('a[data-rel="'+t+'"]').parent().hide()}}(t,s),function(e){var n=e.children(),t=e.children("select").children(":disabled");n.find(".disabled").removeClass("disabled"),t.each((function(){var e=$(this).val();n.find('a[data-rel="'+e+'"]').parent().addClass("disabled")}))}(t),r.open=!0,t.trigger(jse.libs.theme.events.TRANSITION(),r),n.trigger(jse.libs.theme.events.OPEN_FLYOUT(),[t]))},d=function(e){e.preventDefault(),e.stopPropagation();var n=$(this);if(!n.parent().hasClass("disabled")){var t=n.closest(i.container),o=t.children("button"),a=t.children("select"),l=a.children(":selected").val(),d=n.attr("data-rel"),c=n.text(),h=$.extend({},i,t.parseModuleData("dropdown"));if(l!==d){var g=s(o,c,h);o.children(".dropdown-name").text(g),a.children('[value="'+d+'"]').prop("selected",!0),h.triggerChange&&a.trigger("change",[])}else h.triggerNoChange&&a.trigger("change",[]);r.open=!1,t.trigger(jse.libs.theme.events.TRANSITION(),r)}},c=function(){var e=n.find(i.container);i.breakpoint<jse.libs.theme.responsive.breakpoint().id||i.shortenOnMobile?e.each((function(){var e=$(this),n=e.children("button"),t=n.children(".dropdown-name"),r=e.find("select option:selected").text(),o=$.extend({},i,e.parseModuleData("dropdown")),a=s(n,r,o);t.text(a)})):e.removeClass(i.openClass).each((function(){var e=$(this),n=e.find(".dropdown-name"),t=e.find("select option:selected").text();n.text(t)}))},h=function(e,t){var r=n.find(i.container),o=t||$(e.target).closest(i.openClass);(r=r.not(o)).removeClass(i.openClass)};return o.init=function(e){r.classOpen=i.openClass,t.on(jse.libs.theme.events.OPEN_FLYOUT()+" click",h).on(jse.libs.theme.events.BREAKPOINT(),c),n.on("click",i.container+" button",l).on("click",i.container+" ul a",d).on("change",i.container+" select",a),i.shortenOnInit&&c(),e()},o}));